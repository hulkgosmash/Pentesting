# Unpacking

### Standard Process of Unpacking EXE

1. Debug the EXE to find the real OEP (Original Entry Point)
2. At OEP, Dump the fully Unpacked Program to Disk
3. Fix the Import Table
4. Fix the PE Header

### UPX

Packed program entry point should be

<pre class="language-asm6502"><code class="lang-asm6502"><strong>pushad
</strong></code></pre>

Run program so it goes to the entry point then F8 to step over the pushad and then notice the EBP register changes.&#x20;

The program will then continue to unpack in memory

It will resume normal execution after the popad or pop ebp instructions

#### Set hardware breakpoint

1. Find the address in EBP in the stack then right click and follow in dump.
2. Find the location in memory right click on the DWORD then select **Breakpoint** -> **Hardware, Access** -> **Dword**.&#x20;
3. Run program until hardware breakpoint is triggered.&#x20;

#### Dump Binary

1. Jump to original entry point. May have to exit a loop
2. Watch memory address for when program jumps into Base Address and add a comment "Original Entry Point"
3. Push F8 again for it to load the IAT table

<figure><img src="../../.gitbook/assets/image (11) (1).png" alt=""><figcaption></figcaption></figure>

4. Go to plugins click on **Scylla**. Click on **File** -> **Dump Memory**
5. Search for the executable file at the original Base Address location as shown in DIE then click on **Dump PE**. Give the file a name and select **Save**.&#x20;

#### Fix IAT Table

6. Still in Scylla select IAT Autosearch then select No then click OK.&#x20;
7. Click on Get Imports to fix all DLL imports.
8. Click on Fix Dump, select the previously dumped file and select open.
9. A new dump file will be created.&#x20;
