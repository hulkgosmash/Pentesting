# .NET Obfuscation

### Packer

#### **Signature**&#x20;

Lots of arrays in `.cctor` module

<figure><img src="../../../.gitbook/assets/image (7) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

#### **Antidote**&#x20;

1. Set Breakpoint on `gchandle.free`

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

2. Click Start to run debugger, then click OK

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

3. If Modules tab is not shown, you can open it by clicking on **Debug** -> **Windows** -> **Modules**. koi.exe should now be shown in the Modules tab

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

4. Right click on koi and select **Save Module** and save the file somewhere on the file system

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

5. Take the newly unpacked `koi.exe` and open it in the debugger
6. Right click on **koi** module and select **Edit Module**

<figure><img src="../../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

7. Change the **Entry Point** to be **Managed** then select the box next to Managed

<figure><img src="../../../.gitbook/assets/image (7) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

8. Open the program and fine the Main function. Click **OK** then click **OK** again

<figure><img src="../../../.gitbook/assets/image (8) (1) (1).png" alt=""><figcaption></figcaption></figure>

9. Right click and select **Remove** for  the module

<figure><img src="../../../.gitbook/assets/image (9) (1) (1).png" alt=""><figcaption></figcaption></figure>

10. When prompted click Yes to save the file somewhere on the file system



<figure><img src="../../../.gitbook/assets/image (10) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Anti Tamper

#### Signature

An exception occurred when decompiling this method (06000005)

<figure><img src="../../../.gitbook/assets/image (113).png" alt=""><figcaption></figcaption></figure>

EntryPoint VirtualProtect in cctor. Also same with Anti-Dump protection, but Anti-Dump has visible contents within functions.&#x20;

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (115).png" alt=""><figcaption></figcaption></figure>

#### **Antidote**&#x20;

1. Set breakpoint on module static

<figure><img src="../../../.gitbook/assets/image (116).png" alt=""><figcaption></figcaption></figure>

2. Click Start then OK to run.&#x20;

<figure><img src="../../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

3. Go to Debug -> Step Over

<figure><img src="../../../.gitbook/assets/image (118).png" alt=""><figcaption></figcaption></figure>

3. &#x20;Click on the Modules tab then right click on the Anti-Tampering exe file and select **Save Module**

<figure><img src="../../../.gitbook/assets/image (119).png" alt=""><figcaption></figcaption></figure>

4. Open the dumped module in dnSpy. Navigate to the static module

<figure><img src="../../../.gitbook/assets/image (120).png" alt=""><figcaption></figcaption></figure>

5. Right click on the Instruction and select **Edit IL Instructions...**

<figure><img src="../../../.gitbook/assets/image (121).png" alt=""><figcaption></figcaption></figure>

6. Right click then select **NOP Instruction** then click **OK**

<figure><img src="../../../.gitbook/assets/image (122).png" alt=""><figcaption></figcaption></figure>

7. Right click and remove file. When prompted click **Yes** to save it

<figure><img src="../../../.gitbook/assets/image (123).png" alt=""><figcaption></figcaption></figure>

### Constants Protection

#### Signature

You can see the Form and the functions but the parameters of the function calls are obfuscated. In Name Protection, you can't even see the Form.&#x20;

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

#### Antidote

Use UnconfuserEX Tool: **ConfuserExConstantDecryptor**

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Control Flow Protection

#### Signature

cctor static module blank but btn-click-handler has for(;;) and switch-case&#x20;

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

#### Antidote

ConfuserExSwitchKiller

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Anti Dump Protection

#### Signature

EntryPoint VirtualProtect in cctor. Also same with Anti-Tamper protection, but, Anti-Dump has visible contents within functions. Also, with Anti-Dump protection, after dumping, the modules are empty, except for the PE header.&#x20;

<figure><img src="../../../.gitbook/assets/image (5) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

#### Antidote

1. Set a Breakpoint on module static and don't step over

<figure><img src="../../../.gitbook/assets/image (6) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

2. Go to modules tab and save the exe.&#x20;

<figure><img src="../../../.gitbook/assets/image (7) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Reference Proxy Protection

#### Signature

Form methods are obfuscated

<figure><img src="../../../.gitbook/assets/image (8) (1).png" alt=""><figcaption></figcaption></figure>

#### Antidote

ConfuserExCallFixer

<figure><img src="../../../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

### Resources Protection

#### Signature

Open the Resources folder, the resources is empty.&#x20;

<figure><img src="../../../.gitbook/assets/image (10) (1).png" alt=""><figcaption></figcaption></figure>

#### Antidote

1. Right click on program and select **Go to \<Module> .cctor**

![](<../../../.gitbook/assets/image (11) (1).png>)

2. Set a Breakpoint on static module. Start the program then step over

![](<../../../.gitbook/assets/image (12) (1).png>)

3. Dump the gibberish module and stop the debugger

<figure><img src="../../../.gitbook/assets/image (13) (1).png" alt=""><figcaption></figcaption></figure>

4. Open the newly dumped file in dnspy. In Resources, right click, Raw Save resource.&#x20;

<figure><img src="../../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

5. Go back to the other program, right click Resources, create file resource, import the saved resource above.&#x20;

<figure><img src="../../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

5. Delete the old resource.&#x20;

<figure><img src="../../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

6. Right click on program and select **Go to \<Module> .cctor.** Right click on the static module and select  click Edit IL Instructions.&#x20;

<figure><img src="../../../.gitbook/assets/image (17) (1).png" alt=""><figcaption></figcaption></figure>

7. Right click on the module and select **NOP Instruction**. Then click OK.

<figure><img src="../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

8. Dump the resource by removing in from dnSpy and when it asks to save, give the file a new name.&#x20;

### Name Protection

#### Signature

All names/strings everywhere are obfuscated \uxxxx. In Constants Protection, you can see the Form and the functions. But the parameters of the function calls are obfuscated. In Name Protection, you can't even see the Form&#x20;

<figure><img src="../../../.gitbook/assets/image (19) (1).png" alt=""><figcaption></figcaption></figure>

#### Antidote

1. Run de4ot

<figure><img src="../../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

2. Open new file in dnSpy then click start. Take note of the name in the error message.&#x20;

<figure><img src="../../../.gitbook/assets/image (21) (1).png" alt=""><figcaption></figcaption></figure>

3. Find the missing resource then right click on it and select Edit Resource. Then rename Resources/gibberish.resource to Form1.resources. Save the file by closing dnSpy and overwriting the existing \*cleaned.exe file.

<figure><img src="../../../.gitbook/assets/image (22) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

### Do nothing for the protections listed below

dnSpy takes care of them automatically

* Anti IL Dasm
* Anti Debug Protection
* Invalid Metadata Protection
