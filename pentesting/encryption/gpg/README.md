# GPG

## List keys

<table><thead><tr><th width="361">Info</th><th>Command</th></tr></thead><tbody><tr><td>List public keys</td><td><code>gpg --list-keys</code></td></tr><tr><td>List all secret keys</td><td><code>gpg --list-secret-keys</code></td></tr><tr><td>List public but show subkey fingerprints as well</td><td><code>gpg --list-keys --with-subkey-fingerprints</code></td></tr><tr><td>List secret keys, but show subkey fingerprints as well</td><td><code>gpg --list-secret-keys --with-subkey-fingerprints</code></td></tr></tbody></table>

## Use different key ring

<table><thead><tr><th width="318">Info</th><th>Command</th></tr></thead><tbody><tr><td>List keys but use a different home directory for one command only</td><td><code>gpg --homedir ~/.gnupg-alternate --list-keys</code></td></tr><tr><td>Set different home directory for session</td><td><code>export GNUPGHOME=/mnt/c/Users/USER/AppData/Roaming/gnupg/</code></td></tr></tbody></table>

## Generate keys

<table><thead><tr><th width="232">Info</th><th>Command</th></tr></thead><tbody><tr><td>Generate key pair</td><td><code>gpg --full-generate-key</code></td></tr></tbody></table>

## Exporting keys

| Info                                                | Command                                         |
| --------------------------------------------------- | ----------------------------------------------- |
| Export single public keyuseful for backing up keys  | `gpg -a --export KEYID > public.asc`            |
| Export single secret key useful for backing up keys | `gpg -a --export-secret-key KEYID > secret.asc` |
| Export all public keys                              | `gpg -a --export > public-all.asc`              |
| Export all secret keys                              | `gpg -a --export-secret-key > secret-all.asc`   |

## Importing keys

<table><thead><tr><th width="402">Info</th><th>Command</th></tr></thead><tbody><tr><td>List contents of key file without importing it</td><td><code>gpg keys.asc</code></td></tr><tr><td>Verbose option to see fingerprint</td><td><code>gpg --with-subkey-fingerprint keys.asc</code></td></tr><tr><td>Verbose option to see both fingerprint/signatures too</td><td><code>gpg -v keys.asc</code></td></tr><tr><td>Import keys, merging into current key ring</td><td><code>gpg --import keys.asc</code></td></tr></tbody></table>

## Signing a key

| Info                                                                                                                    | Command                                  |
| ----------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| View the fingerprint of a key                                                                                           | `gpg --fingerprint KEYID`                |
| After confirming the key is authentic, sign the key.                                                                    | `gpg --sign-key KEYID`                   |
| Or via the key editor                                                                                                   | `gpg --edit-key KEYID`                   |
|                                                                                                                         | `gpg>fpr`                                |
|                                                                                                                         | `gpg>sign`                               |
|                                                                                                                         | `gpg>save`                               |
| Optionally, export the key again and return to user                                                                     | `gpg -a --export KEYID > signed-key.asc` |
| If you local sign a key, the exported key to others doesn't contain the signatures, the signature is only valid to you. | `gpg --lsign-key KEYID`                  |

## Removing a key signature

| Info                                                                    | Command                                    |
| ----------------------------------------------------------------------- | ------------------------------------------ |
| Removing a local key signature                                          | `gpg --edit-key KEYID`                     |
|                                                                         | `gpg>delsig`                               |
|                                                                         | `gpg>save`                                 |
| Revoking a published key signature. You can not delete a key signature. | `gpg --edit-key KEYID`                     |
|                                                                         | `gpg>revsig`                               |
|                                                                         | `gpg>save`                                 |
| If needed, upload the key and revocation certificate to key servers     | `gpg --send-key KEYID`                     |
| Or export the key with the revoked signature                            | `gpg -a --export KEYID > exported-key.asc` |

## Adding or removing a UID

```bash
gpg --edit-key KEYID
gpg>adduid
(enter details as prompted)
gpg>list
gpg>save
gpg>quit
```

## Changing primary UID

If you have multiple UIDs, this will change which UID is the primary one.

```bash
gpg --edit-key KEYID
gpg>list
gpg>uid X
gpg>primary
gpg>save
gpg>quit
```

## Edit key trust

```
gpg --edit-key KEYID
gpg>trust
gpg>(enter trust level)
gpg>save
```

The trust level you enter is based on:

1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu

Use ultimate only for keys you've generated yourself. Signing a key will automatically set the key's trust level to full.

## Generate a revocation certificate

`gpg -a --gen-revoke KEYID > revoke.asc`

## Renew an expired (sub)key

To change the expiry of a key

```bash
gpg --edit-key KEYID
gpg>expire
gpg>save
```

Then export the new key for distribution, and generate a new revocation certificate for safekeeping. The secret key doesn't change.

```bash
gpg -a --export KEYID > public.asc
gpg -a --gen-revoke KEYID > revoke.asc
```

## Encryption

<table><thead><tr><th width="370">Info</th><th>Command</th></tr></thead><tbody><tr><td>Encrypt file to one recipient key</td><td><code>gpg -e -r KEYID file.txt</code></td></tr><tr><td>Sign and encrypt a file</td><td><code>gpg -s -e -r KEYID file.txt</code></td></tr><tr><td>Encrypt to multiple recipients</td><td><code>gpg -e -r KEY1 -r KEY2 -r KEY3 file.txt</code></td></tr><tr><td>Encrypt and specify output file</td><td><code>gpg -e -r KEYID -o OUTPUT INPUT</code></td></tr><tr><td>Disable compression (enabled by default)</td><td><code>gpg -e -z 0 -r KEYID file.tar.gz</code></td></tr><tr><td>Encrypt contents from standard input</td><td><code>cat "my secret message" | gpg -e -r KEYID > message.txt.gpg</code></td></tr><tr><td>Encrypt contents from standard input</td><td><code>tar -jc /var/log/secret | gpg -z 0 -e -r KEYID > secret.tar.bz2.gpg</code></td></tr><tr><td>Symmetrically encrypt a file using a passphrase</td><td><code>gpg -c file.txt</code></td></tr></tbody></table>

## Create or verify signature

Sign file without encrypting, using a detached signature. This will write to a default file file.txt.asc in the example below.

`gpg -a -s file.txt`

But with clear signed attached signature

`gpg --clear-sign file.txt`

Sign using a non default secret key. Useful if you have multiple secret keys on your key ring.

`gpg --default-key KEYID -a -s file.txt`

Verify a clearsigned or dettached signature

`gpg --verify file.txt.asc`

## Decryption

| Info                                                                          | Command                 |
| ----------------------------------------------------------------------------- | ----------------------- |
| List recipients of a encrypted file                                           | `gpg --list-only FILE`  |
| Decrypt a file to user defined output filename                                | `gpg -d -o OUTPUT FILE` |
| Decrypt a file using default file name, e.g file.txt.gpg decrypts to file.txt | `gpg -d FILE`           |

## Batch encrypt and decrypt

Encrypt all \*.jpg files in the current directory to two recipients, with no compression

`find . -maxdepth 1 -type f -name "*.jpg" -exec gpg -z 0 -e -r KEY1 -r KEY2 -o {}.gpg {} \;`

Decrypt all \*.gpg files in current directory. If --output is not used, it will write file.txt.gpg to file.txt

`gpg --decrypt-files *.gpg`

Do the same using a shell script

{% code overflow="wrap" %}
```bash
#!/bin/bash
read -rsp "Enter passphrase: " PASSPHRASE
for FILE in *.*.gpg; do
    echo "Extracting $FILE to ${FILE%.gpg}."
    echo "$PASSPHRASE" | gpg --passphrase-fd 0 --batch -d --output "${FILE%.gpg}" "$FILE"
done
```
{% endcode %}

Decrypt using passphrase from standard input

`echo "passphrase" | gpg --passphrase-fd 0 --batch -d -o file.txt file.txt.gpg`

## Using a keyserver

KEYID is the last 4 bytes (8 hexadecimal chars) of your fingerprint, e.g D9B2766F

Sending or uploading a key to a key server

`gpg --keyserver SERVER --send-key KEYID`

Receiving a key from a key server

`gpg --keyserver SERVER --recv-key KEYID`

If you don't use the --keyserver SERVER option, the default server will be used. See what your default server is.

`gpgconf --list-options gpg`

Common and popular keyservers are

pgp.mit.edu pool.sks-keyservers.net

Search for keys

`gpg --keyserver SERVER --search-keys STRING`
