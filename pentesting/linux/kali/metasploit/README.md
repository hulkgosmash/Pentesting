# Metasploit

## General

### Paths

```bash
# Modules
/usr/share/metasploit-framework/modules
# Plugins
/usr/share/metasploit-framework/plugins/
# Scripts
/usr/share/metasploit-framework/scripts/
# Tools
/usr/share/metasploit-framework/tools/
```

### MSFconsole Commands

<table data-header-hidden><thead><tr><th width="241">Command</th><th>Description</th></tr></thead><tbody><tr><td><strong>Command</strong></td><td><strong>Description</strong></td></tr><tr><td><code>show payloads</code></td><td>Show all payloads within the Framework.</td></tr><tr><td><code>show auxiliary</code></td><td>Show all auxiliary modules within the Framework.</td></tr><tr><td><code>search &#x3C;name></code></td><td>Search for exploits or modules within the Framework.</td></tr><tr><td><code>info</code></td><td>Load information about a specific exploit or module.</td></tr><tr><td><code>use &#x3C;name></code></td><td>Load an exploit or module (example: use windows/smb/psexec).</td></tr><tr><td><code>use &#x3C;number></code></td><td>Load an exploit by using the index number displayed after the search command.</td></tr><tr><td><code>LHOST</code></td><td>Your local host’s IP address reachable by the target, often the public IP address when not on a local network. Typically used for reverse shells.</td></tr><tr><td><code>RHOST</code></td><td>The remote host or the target. set function Set a specific value (for example, LHOST or RHOST).</td></tr><tr><td><code>setg &#x3C;function></code></td><td>Set a specific value globally (for example, LHOST or RHOST).</td></tr><tr><td><code>show options</code></td><td>Show the options available for a module or exploit.</td></tr><tr><td><code>show targets</code></td><td>Show the platforms supported by the exploit.</td></tr><tr><td><code>set target &#x3C;number></code></td><td>Specify a specific target index if you know the OS and service pack.</td></tr><tr><td><code>set payload &#x3C;payload></code></td><td>Specify the payload to use.</td></tr><tr><td><code>set payload &#x3C;number></code></td><td>Specify the payload index number to use after the show payloads command.</td></tr><tr><td><code>show advanced</code></td><td>Show advanced options.</td></tr><tr><td><code>set autorunscript migrate -f</code></td><td>Automatically migrate to a separate process upon exploit completion.</td></tr><tr><td><code>check</code></td><td>Determine whether a target is vulnerable to an attack.</td></tr><tr><td><code>exploit</code></td><td>Execute the module or exploit and attack the target.</td></tr><tr><td><code>exploit -j</code></td><td>Run the exploit under the context of the job. (This will run the exploit in the background.)</td></tr><tr><td><code>exploit -z</code></td><td>Do not interact with the session after successful exploitation.</td></tr><tr><td><code>exploit -e &#x3C;encoder></code></td><td>Specify the payload encoder to use (example: exploit –e shikata_ga_nai).</td></tr><tr><td><code>exploit -h</code></td><td>Display help for the exploit command.</td></tr><tr><td><code>sessions -l</code></td><td>List available sessions (used when handling multiple shells).</td></tr><tr><td><code>sessions -l -v</code></td><td>List all available sessions and show verbose fields, such as which vulnerability was used when exploiting the system.</td></tr><tr><td><code>sessions -s &#x3C;script></code></td><td>Run a specific Meterpreter script on all Meterpreter live sessions.</td></tr><tr><td><code>sessions -K</code></td><td>Kill all live sessions.</td></tr><tr><td><code>sessions -c &#x3C;cmd></code></td><td>Execute a command on all live Meterpreter sessions.</td></tr><tr><td><code>sessions -u &#x3C;sessionID></code></td><td>Upgrade a normal Win32 shell to a Meterpreter console.</td></tr><tr><td><code>db_create &#x3C;name></code></td><td>Create a database to use with database-driven attacks (example: db_create autopwn).</td></tr><tr><td><code>db_connect &#x3C;name></code></td><td>Create and connect to a database for driven attacks (example: db_connect autopwn).</td></tr><tr><td><code>db_nmap</code></td><td>Use Nmap and place results in a database. (Normal Nmap syntax is supported, such as –sT –v –P0.)</td></tr><tr><td><code>db_destroy</code></td><td>Delete the current database.</td></tr><tr><td><code>db_destroy &#x3C;user:password@host:port/database></code></td><td>Delete database using advanced options.</td></tr><tr><td></td><td></td></tr></tbody></table>

***

### Meterpreter Commands

| **Command**                                           | **Description**                                                                               |
| ----------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| `help`                                                | Open Meterpreter usage help.                                                                  |
| `run <scriptname>`                                    | Run Meterpreter-based scripts; for a full list check the scripts/meterpreter directory.       |
| `sysinfo`                                             | Show the system information on the compromised target.                                        |
| `ls`                                                  | List the files and folders on the target.                                                     |
| `use priv`                                            | Load the privilege extension for extended Meterpreter libraries.                              |
| `ps`                                                  | Show all running processes and which accounts are associated with each process.               |
| `migrate <proc. id>`                                  | Migrate to the specific process ID (PID is the target process ID gained from the ps command). |
| `use incognito`                                       | Load incognito functions. (Used for token stealing and impersonation on a target machine.)    |
| `list_tokens -u`                                      | List available tokens on the target by user.                                                  |
| `list_tokens -g`                                      | List available tokens on the target by group.                                                 |
| `impersonate_token <DOMAIN_NAMEUSERNAME>`             | Impersonate a token available on the target.                                                  |
| `steal_token <proc. id>`                              | Steal the tokens available for a given process and impersonate that token.                    |
| `drop_token`                                          | Stop impersonating the current token.                                                         |
| `getsystem`                                           | Attempt to elevate permissions to SYSTEM-level access through multiple attack vectors.        |
| `shell`                                               | Drop into an interactive shell with all available tokens.                                     |
| `execute -f <cmd.exe> -i`                             | Execute cmd.exe and interact with it.                                                         |
| `execute -f <cmd.exe> -i -t`                          | Execute cmd.exe with all available tokens.                                                    |
| `execute -f <cmd.exe> -i -H -t`                       | Execute cmd.exe with all available tokens and make it a hidden process.                       |
| `rev2self`                                            | Revert back to the original user you used to compromise the target.                           |
| `reg <command>`                                       | Interact, create, delete, query, set, and much more in the target’s registry.                 |
| `setdesktop <number>`                                 | Switch to a different screen based on who is logged in.                                       |
| `screenshot`                                          | Take a screenshot of the target’s screen.                                                     |
| `upload <filename>`                                   | Upload a file to the target.                                                                  |
| `download <filename>`                                 | Download a file from the target.                                                              |
| `keyscan_start`                                       | Start sniffing keystrokes on the remote target.                                               |
| `keyscan_dump`                                        | Dump the remote keys captured on the target.                                                  |
| `keyscan_stop`                                        | Stop sniffing keystrokes on the remote target.                                                |
| `getprivs`                                            | Get as many privileges as possible on the target.                                             |
| `uictl enable <keyboard/mouse>`                       | Take control of the keyboard and/or mouse.                                                    |
| `background`                                          | Run your current Meterpreter shell in the background.                                         |
| `hashdump`                                            | Dump all hashes on the target. use sniffer Load the sniffer module.                           |
| `sniffer_interfaces`                                  | List the available interfaces on the target.                                                  |
| `sniffer_dump <interfaceID> pcapname`                 | Start sniffing on the remote target.                                                          |
| `sniffer_start <interfaceID> packet-buffer`           | Start sniffing with a specific range for a packet buffer.                                     |
| `sniffer_stats <interfaceID>`                         | Grab statistical information from the interface you are sniffing.                             |
| `sniffer_stop <interfaceID>`                          | Stop the sniffer.                                                                             |
| `add_user <username> <password> -h <ip>`              | Add a user on the remote target.                                                              |
| `add_group_user <"Domain Admins"> <username> -h <ip>` | Add a username to the Domain Administrators group on the remote target.                       |
| `clearev`                                             | Clear the event log on the target machine.                                                    |
| `timestomp`                                           | Change file attributes, such as creation date (antiforensics measure).                        |
| `reboot`                                              | Reboot the target machine.                                                                    |
