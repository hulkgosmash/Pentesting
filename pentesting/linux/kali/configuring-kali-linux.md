# Configuring Kali Linux

## Managing Users and Groups

### Modifying Accounts & Passwords

* `passwd`—permits a regular user to change their password, which in turn, updates the `/etc/shadow` file.
* `chfn`—(CHange Full Name), reserved for the super-user (root), modifies the `GECOS`, or "general information" field.
* `chsh`—(CHange SHell) changes the user's login shell. However, available choices will be limited to those listed in `/etc/shells`; the administrator, on the other hand, is not bound by this restriction and can set the shell to any program chosen.
* `chage`—(CHange AGE) allows the administrator to change the password expiration settings by passing the user name as an argument or list current settings using the `-l user` option. Alternatively, you can also force the expiration of a password using the `passwd -e user` command, which forces the user to change their password the next time they log in.

### Disabling an Account

```bash
# Lock a user account
passwd -l user
# Unlock a user account
passwd -u user
```

### Managing Groups

```bash
# Add a group
addgroup group
# Delete a group
delgroup group
# Change password for a group
gpasswd group
# Delete password for a group
gpasswd -r group
# Start a new shell as a group
newgrp
# Run a command as a group
sg
# Show users groups
id
```

## Services

### Configuring a Specific Program

```bash
# List all of the files included in a package
dpkg -L package
# Display the package metadata
dpkg -s package
```

### Configuring SSH for remote logins

```bash
# Manually start the SSH service
systemctl start ssh
# Configure SSH service to start at boot time
systemctl enable ssh
# Modify the configuration
nano /etc/ssh/sshd_config
# To apply modified configuration
systemctl reload ssh
# Host keys are located here
/etc/ssh/ssh_host_*
# Reload host keys
passwd
[...]
rm /etc/ssh/ssh_host_*
dpkg-reconfigure openssh-server
systemct restart ssh
```

### Configuring PostgreSQL Databases

{% code overflow="wrap" %}
```bash
# Start the service
systemctl start postgresql

# Create users and databases
su - postgres
createuser -P king_phisher
Enter password for new role:
Enter it again:
postgres@kali:~$ createdb -T template0 -E UTF-8 -O king_phisher king_phisher
postgres@kali:~$ exit

# Test connection to database
psql -h localhost -U king_phisher king_phisher
Password for user king_phisher:
psql (9.5.2)
SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
Type "help" for help.

king_phisher=>
```
{% endcode %}

### Configuring Apache

```bash
# Start service
systemctl start apache2
# Enable a module
a2enmod _module_
# Disable a module
a2dismod module
# Enable SSL
a2enmod ssl
# By default apache listens oon port 80 as configured in
/etc/apache2/ports.conf
# And serves pages from 
/var/www/html
# As configured in 
/etc/apache2/sites-enabled/000-default.conf

# Configuring Virtual Hosts
# Default configuration file is located here
/etc/apache2/sites-enabled/000-default.conf
# Extra virtual host is then described by a file stored in 
/etc/apache2/sites-available/
# For example
www.kali.org.conf
# Enable the new virtual host with
a2ensite www.kali.org
# Example minimal virtual host configuration
<VirtualHost *:80>
ServerName www.kali.org
ServerAlias kali.org
DocumentRoot /srv/www.kali.org/www
</VirtualHost>

# Common Directives

# Requiring Authentication
# Example .htaccess file
Require valid-user
AuthName "Private directory"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private

# This file contains list of users and passwords
/etc/apache2/authfiles/htpasswd-private
# Manipulate it with the command
htpasswd

# Restricting Access
Require ip 192.168.0.0/16
```

## Managing Services

```bash
# Output a list of the active units. 
systemctl
# Hierarchical overview of the running services
systemctl status
# Set a service to start automatically on system boot
systemctl enable service
# Disable a service from starting automatically on system boot
systemctl disable service
# Manually start a system service
systemctl start service
# Manually stop a system service
systemctl stop service
# Check the status of a system service
systemctl status service
# Reload the configuration after a change
systemctl reload service
# Restart a service
systemctl restart service
```
