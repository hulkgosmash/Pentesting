# Wireshark Display Filters

Display filters affect which packets are visible in Wireshark's packet list. These filters impact what is displayed only, meaning that Wireshark may be capturing additional packets that are not visible.

Display filters are applied and edited in the _Filter_ toolbar located between the _Main_ toolbar and the packet list.

<figure><img src="../../../../../../.gitbook/assets/image (1) (1) (2) (1).png" alt=""><figcaption><p>Packet list columns</p></figcaption></figure>

We will use display filters in a few different features in order to customize Wireshark and make our work easier.

**Display Filter Expression**

The best way to understand the syntax of Wireshark display filters is to create one with the Display Filter Expression screen. Let's select _Analyze_ > _Display Filter Expression..._ to open the screen with all the available filters.

<figure><img src="../../../../../../.gitbook/assets/image (18) (3).png" alt=""><figcaption><p>Display Filter Expression builder</p></figcaption></figure>

Each display filter has a _field name_ and _relation_, as well as a _value_, if applicable. The textbox highlighted in green is where the filter expression is displayed.

We can think of the _field_ as an object with one or more items. The field can be built using dot-notation. This is similar to what we would see in object-oriented programming languages. The _Field Name_ displays the object and a short description.

Hovering the mouse in the _Relation_ window displays a pop-up that provides more details.

<figure><img src="../../../../../../.gitbook/assets/image (38).png" alt=""><figcaption><p>Display Filter Expression builder - Relation explanations</p></figcaption></figure>

A display filter expression's _relation_ can be one of the following: _is present_, _==_, _!=_, _<_, _>_, _>=_, _<=_, _contains_, _matches_, or _in_. Depending on the field selected, not all relations will be available.

The _Search_ field, located below the _Field Name_ list, is useful when we can't remember a specific filter. It will narrow down the list of field names as we type, and it shows matching results from both the names and their descriptions.

<figure><img src="../../../../../../.gitbook/assets/image (10) (2).png" alt=""><figcaption><p>Display Filter Expression builder - Searching for 'wlan.fc'</p></figcaption></figure>

The _Predefined Values_ window contains a number of options that relate to different byte values in certain packet fields. For example, _wlan.fc.type_ can have four different values: 0, 1, 2, and 3. These relate to _Management_, _Control_, _Data_, and _Extension_ frames, respectively. Our chosen "wlan.fc.type == 2" filter in Figure 13 has "byte value 2", which filters for _data frames_.

Clicking _OK_ updates the contents of the display filter toolbar with our selected filter and the resultant packets as shown in Figure 14.

<figure><img src="../../../../../../.gitbook/assets/image (35).png" alt=""><figcaption><p>Display Filter Expression builder - Applied filter 'wlan.fc.type == 2'</p></figcaption></figure>

**Packet Details**

We can also build filters based on items from a selected packet. Let's illustrate this by creating a data frame packet filter. We will start by selecting a data packet from the packet list.

<figure><img src="../../../../../../.gitbook/assets/image (30).png" alt=""><figcaption><p>Display Filter Expression builder - Data frame</p></figcaption></figure>

In the packet's detail window, let's expand the _IEEE 802.11 Data, Flags_ field and the _Frame Control Field_ and then right click the _Type: Data frame (2)_ element. Finally, we'll select _Apply as Filter_ (selecting _Analyze_ in the Main toolbar also displays these options).

<figure><img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/PEN-210/images/Wireshark_Essentials/38de25b9783feff99bc489c58a940429-we_wireshark_apply_filter2.png" alt="Figure 16: Apply as Filter submenu"><figcaption><p>Apply as Filter submenu</p></figcaption></figure>

Now we have a number of options to choose from.

* _Selected_ clears the display filter bar of any existing queries and generates a new query to search for this specific value. For example, wlan.fc.type with a value of "2" generates "wlan.fc.type == 2" in the display filter bar.
* _... and Selected_ appends to any existing query by using an _AND_ (&&) condition. Taking the query we created above and adding a wlan.fc.subtype value of "0" generates "(wlan.fc.type == 2) && (wlan.fc.subtype== 0)" in the display filter bar.
* _... or Selected_ does the same as the above filter but instead of using an AND, it uses an _OR_ (||) condition.

All the choices containing "Not" negate their equivalent in the positive form. For example, if we have "wlan.fc.type == 2" as an existing filter and use _... and not Selected_ with wlan.fc.subtype and value of "0", the filter becomes "(wlan.fc.type == 2) && !(wlan.fc.subtype == 0)".

Note that _Apply as filter_ builds and applies the filter immediately. While _Prepare a filter_ only updates the contents of the display filter bar and doesn't apply the filter until we click _Apply display filter_ at the end of the display filter textbox.

<figure><img src="../../../../../../.gitbook/assets/3aa321e21cd5f064084b19b4270cff65-we_apply_df_blue_button3.png" alt=""><figcaption><p>Apply as Filter submenu</p></figcaption></figure>

_Prepare a filter_ is useful when we want to build a complex filter that will require multiple steps. As the list of collected packets gets longer, it can take time to process each new subfilter that gets applied. It might be easier to wait to apply the filter until after we have finished writing the complete query.

**Display Filter Toolbar**

We can also create and access display filters directly in the Display Filter toolbar. On the left, a blue ribbon icon will bring us to bookmarked filters.

<figure><img src="../../../../../../.gitbook/assets/e8f2a6e435bf69c73204ed71140fa4e0-ws_display_filter_bar2.png" alt=""><figcaption><p>Display Filter bar</p></figcaption></figure>

To the right of the filter bar there is an arrow and a dropdown icon. The arrow will apply the filter, while the dropdown will show the most recent display filters.

<figure><img src="../../../../../../.gitbook/assets/3610378176ad90f74cc8d95e13338677-ws_recent_df.png" alt=""><figcaption><p>Display Filter bar - Recent filters dropdown</p></figcaption></figure>

When creating a filter, Wireshark's autocompletion displays valid filters as the expression is typed.

<figure><img src="../../../../../../.gitbook/assets/7d1b9abbfe4b70919439179a921a5574-ws_dfilter_autocomplete.png" alt=""><figcaption><p>Display filter autocomplete</p></figcaption></figure>

The toolbar provides filtering hints with colored backgrounds. A valid filter is displayed with a green background. An invalid filter is indicated by a red background. For example, the "wlan.fc.type = 1" filter is syntactically incorrect because it uses only a single "=", so it appears with a red background.

<figure><img src="../../../../../../.gitbook/assets/d9184f5a570297da97c0ecbe99e6aa61-ws_wireshark_red_df.png" alt=""><figcaption><p>Invalid filter</p></figcaption></figure>

A yellow background indicates a possibly questionable filter.

<figure><img src="../../../../../../.gitbook/assets/b23f8d6d0d478d67984d5f9ad7696fdc-ws_wireshark_yellow_df.png" alt=""><figcaption><p>Filter with possibly unexpected results</p></figcaption></figure>

Yellow doesn't always mean the filter is incorrect. In most cases, it will be correct as most filters reference a single field. In this specific example, it is correct and will show packets with a wlan.fc.type with a value not equal to "1". It is good practice to use the double equal and then negate the entire expression instead. This would be written as "!(wlan.fc.type == 1)".

**Display Filters Bookmarks**

When doing a lot of packet filtering, we may want to reuse filters. This is where the bookmarks come in handy. They allow us to save display filters for later use. The bookmark button is located on the left of the Display Filter toolbar.

<figure><img src="../../../../../../.gitbook/assets/e8f2a6e435bf69c73204ed71140fa4e0-ws_display_filter_bar2 (1).png" alt=""><figcaption><p>Display Filter bar</p></figcaption></figure>

Clicking on the bookmark reveals a default set of display filters and any additional saved filters.

<figure><img src="../../../../../../.gitbook/assets/4a98d379e7f9044f44fba2f587a6c0df-ws_df_toolbar_bookmark_icon.png" alt=""><figcaption><p>Display Filter bar</p></figcaption></figure>

When a valid filter is in the Display Filter toolbar, _Save this filter_ is clickable in the bookmark dropdown menu. Saving the filter opens the _Display Filters_ screen and the new filter is displayed at the bottom of the list. Selecting _OK_ saves the filter in the bookmark list.

<figure><img src="../../../../../../.gitbook/assets/1cd3ebbd07016c2e9a61959c422fa25c-ws_df_save_filter2.png" alt=""><figcaption><p>Display filter window - Save filter</p></figcaption></figure>

We can create and save a new filter by either selecting _Manage Display Filters_ from the bookmarks dropdown menu or via _Analyze_ > _Display Filters..._. Both of these options open the Display Filters screen.

We can edit an existing filter by selecting it and applying valid changes. Valid changes are indicated by the green (or yellow) background in the Filter field. Filters from the list can be deleted with the minus ("-") button or duplicated with the _Copy_ button.

**Display Filter Buttons**

We can add a shortcut to the Display Filter toolbar for frequently used filters by selecting the plus ("+") icon located on the very right of the toolbar. This opens a Create Shortcut Button panel.

<figure><img src="../../../../../../.gitbook/assets/54e66238305aeb93990cafc9d150d0cd-ws_display_filter_button_empty2.png" alt=""><figcaption><p>Display Filter button settings</p></figcaption></figure>

We will enter the name of the shortcut in the _Label_ field and enter the filter in the _Filter_ field. The _Comment_ field is for a description that appears when hovering the mouse over the shortcut button.

Let's create a "Data" button using our "wlan.fc.type == 2" data frames filter and an "802.11 data frames" comment.

<figure><img src="../../../../../../.gitbook/assets/bfcf82e4637372d6cdbdd81de837f97a-ws_display_filter_button_creation2.png" alt=""><figcaption><p>Display Filter button creation</p></figcaption></figure>

Selecting _OK_ creates our _Data_ button to the right on the Display Filter toolbar. Hovering the mouse on the button displays the filter's comment.

<figure><img src="../../../../../../.gitbook/assets/79ae5ad5bef04a423d3929f0c3aa2f34-ws_display_filter_button2.png" alt=""><figcaption><p>Display Filter button</p></figcaption></figure>

Clicking on our new button sets the content of the filter toolbar to "wlan.fc.type == 2". Right-clicking the button gives us options to edit, disable, or remove the button.

<figure><img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/PEN-210/images/Wireshark_Essentials/418e32c45bee23fb3a0bffef020c50a3-ws_dfilter_button_right_click2.png" alt="Figure 28: Display Filter buttons preferences"><figcaption><p>Display Filter buttons preferences</p></figcaption></figure>

Editing a button will bring back the creation panel below the Display Filter bar. This time, the creation panel will be prefilled with the button's existing settings.

Filter buttons can also be created, deleted, or edited via _Edit_ > _Preferences..._, and selecting _Filter Buttons_ in the left panel.

<figure><img src="../../../../../../.gitbook/assets/eecaaae92de6cb77f821aa1503beeffb-ws_display_filter_buttons_prefs2.png" alt=""><figcaption><p>Display Filter buttons preferences</p></figcaption></figure>

**Exercise**

Configure your lab AP to use WPA encryption, either with TKIP or CCMP (sometimes shown as AES). Ensure that your wireless card is in monitor mode on the same channel as your AP.

With a capture running, create a display filter for the BSSID of your lab AP. The BSSID is usually printed on a sticker on the back on the AP but can also be found in the frames by looking for Beacon frames with your SSID.
