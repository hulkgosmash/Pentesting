# RC4

RC4 was designed by Ron Rivest from RSA Security and was chosen for wireless encryption due to its simplicity and impressive speed.

RC4 is a symmetric cipher, meaning that the same key is used to both encrypt and decrypt the data. It creates a stream of bits that are XOR'd with plain text to get the encrypted data. To decrypt it, we can simply XOR the encrypted text with the key stream in order to recover the plain text.

RC4 consists of two key elements:

1. **Key Scheduling Algorithm (KSA)**: Initializes the state table with the IV and WEP key
2. **Pseudo-Random Generation Algorithm (PRGA)**: Creates the keystream

Figure 2 illustrates the encryption and decryption of plain text data using the keystream generated above.

<figure><img src="../../../../../../.gitbook/assets/image (5) (2) (1).png" alt=""><figcaption><p>RC4 encryption/decryption overview</p></figcaption></figure>

Below, in Figure 3, we have a diagram outlining the WEP encryption process.

<figure><img src="../../../../../../.gitbook/assets/image (23) (1).png" alt=""><figcaption><p>The WEP encryption process</p></figcaption></figure>

A brief outline of the steps involved in WEP encryption is:

1. Concatenate the IV and WEP key, then run KSA and PRGA to get the keystream.
2. Create the Integrity Check Value (ICV) of the message, then concatenate it to the message.
3. XOR the plain text message plus the CRC32 and the keystream to obtain the encrypted text.
4. The packet then contains the following elements:

* IV (Used Previously)
  * Key ID
  * Encrypted Text
  * ICV that is the CRC32 of the plain text

The WEP decryption process flows according to Figure 4 as shown below.

<figure><img src="../../../../../../.gitbook/assets/image (29).png" alt=""><figcaption><p>The WEP decryption process</p></figcaption></figure>

The steps that take place during the decryption process are as follows:

1. Concatenate the IV and the key corresponding to the key ID, then run KSA and PRGA to obtain the keystream.
2. XOR the encrypted message and the keystream, resulting in the message + ICV.
3. Compare the decrypted ICV with the one received with the packet. If they are the same, the frame is intact and accepted, otherwise, discard the frame, as the packet is fake or corrupted.
