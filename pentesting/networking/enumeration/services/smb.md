# SMB

## SMB Version & Operating System

<table><thead><tr><th width="127">Version</th><th>Operating System(s)</th></tr></thead><tbody><tr><td>CIFS</td><td>Microsoft Windows NT 4.0</td></tr><tr><td>SMB 1.0</td><td>Windows 2000, Windows XP, Windows Server 2003 and Windows Server 2003 R2</td></tr><tr><td>SMB 2.0</td><td>Windows Vista &#x26; Windows Server 2008</td></tr><tr><td>SMB 2.1</td><td>Windows 7 and Windows Server 2008 R2</td></tr><tr><td>SMB 3.0</td><td>Windows 8 and Windows Server 2012</td></tr><tr><td>SMB 3.0.2</td><td>Windows 8.1 and Windows Server 2012 R2</td></tr><tr><td>SMB 3.1.1</td><td>Windows 10 and Windows Server 2016</td></tr></tbody></table>

## Initial Scans

<table><thead><tr><th width="222">Info</th><th>Command</th></tr></thead><tbody><tr><td>netbios scan</td><td><code>nbtscan -r $ip</code></td></tr><tr><td>Enumerate Hostname</td><td><code>nmblookup -A $ip</code></td></tr><tr><td>List Shares</td><td><code>smbmap -H $ip -u guest</code></td></tr><tr><td>List Shares</td><td><code>smbclient -L \\$ip</code></td></tr><tr><td>List Shares (Other stuff)</td><td><code>crackmapexec smb $ip --shares</code></td></tr><tr><td>List Shares</td><td><code>nmap --script smb-enum-shares -p 139,445 $ip</code></td></tr><tr><td>List Shares with creds</td><td><code>smbmap -u $user -p $password -R -H $ip_or_dns</code></td></tr><tr><td>Exhaustive Scan</td><td><code>enum4linux -a -M -l -d $ip</code></td></tr><tr><td>Check Null Sessions</td><td><code>smbmap -H $ip</code></td></tr><tr><td>Check Null Sessions</td><td><code>rpcclient -U "" -N $ip</code></td></tr><tr><td>Check Null Sessions</td><td><code>enum4linux -a -M -l -d $ip</code></td></tr><tr><td>Check Null Sessions</td><td><code>smbclient \\\\$ip\\[share name]</code></td></tr><tr><td>Vulnerability scan</td><td><code>nmap --script smb-vuln* -p 139,445 $ip</code></td></tr><tr><td>Verify Credentials</td><td><code>crackmapexec smb $ip_or_dns -u $user -p $password</code></td></tr></tbody></table>

## Connect to shares

<table><thead><tr><th width="245">Info</th><th>Command</th></tr></thead><tbody><tr><td>Connect</td><td><code>smbclient //$ip/$share</code></td></tr><tr><td>Connect with credentials</td><td><code>smbclient //$ip/$share -U "administrator"</code></td></tr><tr><td>Recursively List Contents</td><td><code>smbmap -H $ip --depth 10 -R $share</code></td></tr><tr><td>Connect with credentials</td><td><code>smbclient \\\\$ip\\$share -U "$user" -p "$password"</code></td></tr><tr><td>Mount share</td><td><code>sudo mount -t cifs -o 'username=TempUser,password=welcome2019' //$ip/Secure$ /mnt/secure</code></td></tr></tbody></table>

## Share Permissions

<table><thead><tr><th width="250">Info</th><th>Command</th></tr></thead><tbody><tr><td>Check share permissions</td><td><code>smbcacls --no-pass //$ip/$share</code></td></tr></tbody></table>

## Change Password

<table><thead><tr><th width="239">Info</th><th>Command</th></tr></thead><tbody><tr><td>Change users password</td><td><code>smbpasswd -r $ip -U sbradley</code></td></tr></tbody></table>

## Download Files

<table><thead><tr><th width="223">Info</th><th>Command</th></tr></thead><tbody><tr><td>Dump share #1</td><td><code>RECURSE ON</code></td></tr><tr><td>Dump share #2</td><td><code>PROMPT OFF</code></td></tr><tr><td>Dump share #3</td><td><code>mget *</code></td></tr><tr><td>Download specific file</td><td><code>smbmap -H $ip --depth 10 -R $share --depth 10 -A Groups.xml -q</code></td></tr></tbody></table>
