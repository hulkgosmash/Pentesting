# SMB

## SMB Version & Operating System

| Version   | Operating System(s)                                                      |
| --------- | ------------------------------------------------------------------------ |
| CIFS      | Microsoft Windows NT 4.0                                                 |
| SMB 1.0   | Windows 2000, Windows XP, Windows Server 2003 and Windows Server 2003 R2 |
| SMB 2.0   | Windows Vista & Windows Server 2008                                      |
| SMB 2.1   | Windows 7 and Windows Server 2008 R2                                     |
| SMB 3.0   | Windows 8 and Windows Server 2012                                        |
| SMB 3.0.2 | Windows 8.1 and Windows Server 2012 R2                                   |
| SMB 3.1.1 | Windows 10 and Windows Server 2016                                       |

## Initial Scans

| Info                      | Command                                             |
| ------------------------- | --------------------------------------------------- |
| netbios scan              | `nbtscan -r $ip`                                    |
| Enumerate Hostname        | `nmblookup -A $ip`                                  |
| List Shares               | `smbmap -H $ip -u guest`                            |
| List Shares               | `smbclient -L \\$ip`                                |
| List Shares (Other stuff) | `crackmapexec smb $ip --shares`                     |
| List Shares               | `nmap --script smb-enum-shares -p 139,445 $ip`      |
| List Shares with creds    | `smbmap -u $user -p $password -R -H $ip_or_dns`     |
| Exhaustive Scan           | `enum4linux -a -M -l -d $ip`                        |
| Check Null Sessions       | `smbmap -H $ip`                                     |
| Check Null Sessions       | `rpcclient -U "" -N $ip`                            |
| Check Null Sessions       | `enum4linux -a -M -l -d $ip`                        |
| Check Null Sessions       | `smbclient \\\\$ip\\[share name]`                   |
| Vulnerability scan        | `nmap --script smb-vuln* -p 139,445 $ip`            |
| Verify Credentials        | `crackmapexec smb $ip_or_dns -u $user -p $password` |

## Connect to shares

| Info                      | Command                                                                                    |
| ------------------------- | ------------------------------------------------------------------------------------------ |
| Connect                   | `smbclient //$ip/$share`                                                                   |
| Connect with credentials  | `smbclient //$ip/$share -U "administrator"`                                                |
| Recursively List Contents | `smbmap -H $ip --depth 10 -R $share`                                                       |
| Connect with credentials  | `smbclient \\\\$ip\\$share -U "$user" -p "$password"`                                      |
| Mount share               | `sudo mount -t cifs -o 'username=TempUser,password=welcome2019' //$ip/Secure$ /mnt/secure` |

## Share Permissions

| Info                    | Command                           |
| ----------------------- | --------------------------------- |
| Check share permissions | `smbcacls --no-pass //$ip/$share` |

## Change Password

| Info                  | Command                        |
| --------------------- | ------------------------------ |
| Change users password | `smbpasswd -r $ip -U sbradley` |

## Download Files

| Info                   | Command                                                          |
| ---------------------- | ---------------------------------------------------------------- |
| Dump share #1          | `RECURSE ON`                                                     |
| Dump share #2          | `PROMPT OFF`                                                     |
| Dump share #3          | `mget *`                                                         |
| Download specific file | `smbmap -H $ip --depth 10 -R $share --depth 10 -A Groups.xml -q` |
