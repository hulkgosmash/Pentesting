# Docker

## General

```bash
# Managing images
## List images
docker image ls
## Download an image
docker image pull ubuntu:22.04
## Remove an image
docker image rm ubuntu:22.04
## Build an image
docker image build

# Running containers
## Run the helloworld container interactively '-it' with bash shell
docker run -it helloworld /bin/bash
## Run the container in detached mode
docker run -d
## Run the container and bind to port 80
docker run -p 80:80
## List running containers
docker ps
## List containers including stopped ones
docker ps -a

# Build containers
docker build -t helloworld .
```

## Dockerfiles

### Commands

| Instruction | Description                                                                                                                                       | Example                                                                                                                     |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| FROM        | This instruction sets a build stage for the container as well as setting the base image (operating system). All Dockerfiles must start with this. | FROM ubuntu                                                                                                                 |
| RUN         | This instruction will execute commands in the container within a new layer.                                                                       | RUN whoami                                                                                                                  |
| COPY        | This instruction copies files from the local system to the working directory in the container (the syntax is similar to the `cp` command).        | COPY /home/cmnatic/myfolder/app/                                                                                            |
| WORKDIR     | This instruction sets the working directory of the container. (similar to using `cd` on Linux).                                                   | <p>WORKDIR /<br>(sets to the root of the filesystem in the container)</p>                                                   |
| CMD         | This instruction determines what command is run when the container starts (you would use this to start a service or application).                 | CMD /bin/sh -c script.sh                                                                                                    |
| EXPOSE      | This instruction is used to tell the person who runs the container what port they should publish when running the container.                      | <p>EXPOSE 80</p><p>(tells the person running the container to publish to port 80 i.e. <code>docker run -p 80:80</code>)</p> |

### Example

```yml
# THIS IS A COMMENT
FROM ubuntu:22.04

# Update the APT repository to ensure we get the latest version of apache2
RUN apt-get update -y 

# Install apache2
RUN apt-get install apache2 -y

# Tell the container to expose port 80 to allow us to connect to the web server
EXPOSE 80 

# Tell the container to run the apache2 service
CMD ["apache2ctl", "-D","FOREGROUND"]
```

### Optimising Dockerfile

Before

```yml
FROM ubuntu:latest
RUN apt-get update -y
RUN apt-get upgrade -y
RUN apt-get install apache2 -y
RUN apt-get install net-tools -y
```

After

{% code overflow="wrap" %}
```yml
FROM ubuntu:latest
RUN apt-get update -y && apt-get upgrade -y && apt-get install apache2 -y && apt-get install net-tools
```
{% endcode %}
